<h2 id="learning-objectives">Learning Objectives</h2>
<p>After completing this lesson, you&rsquo;ll be able to:</p>
<ul>
<li>Define a spatial join.</li>
<li>Define a spatial filter.</li>
<li>Identify why you might use a spatial join or filter.</li>
<li>Identify which transformer or transformers can be used for a particular spatial joining or filtering task.</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>In this course, you'll learn about transformers you can use for spatial joining, filtering, and analysis. These transformers will help you get more value from your spatial data by combining them and conducting queries that combine multiple spatial datasets.</p>
<h2 id="what-is-spatial-joining-and-filtering">What Is Spatial Joining and Filtering?</h2>
<p><strong>Spatial joining&nbsp;</strong>is a procedure that combines information between two datasets based on their spatial location. You might be familiar with key-based attribute joins, which join two tables based on a shared attribute. Spatial joins are similar, except instead of using an attribute value as the shared key, they use spatial location.</p>
<p>For example, you might read one dataset of transit stations and one dataset of postcode boundaries. You want to add an attribute to the transit stations that records their postcode. You could use the PointOnAreaOverlayer to join the postcode attributes to the stations based on which postcode they overlay. Now, you have a stream of station features that contain the postcode attribute.</p>
<blockquote>
<p><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /></p>
<p><span style="font-family: inherit; font-size: 1em;">FME can also do key-based attribute joins. See the course&nbsp;</span><a style="font-family: inherit; font-size: 1em; background-color: #ffffff;" href="https://academy.safe.com/join-tables" target="_blank" rel="noopener">Join Tables</a><span style="font-family: inherit; font-size: 1em;">.</span></p>
</blockquote>
<p><strong>Spatial filtering&nbsp;</strong>is a procedure that separates features based on their spatial location. In FME, this filtering lets you create multiple data streams and do what you wish with each separate stream.</p>
<p>For example, you might read one dataset of transit stations and one dataset of postcode boundaries. You want to filter your data to select transit stations within a single postcode. You could use the SpatialFilter transformer to produce a data stream containing only those features.</p>
<p>In FME, filtering usually refers to creating multiple streams, but the line between filtering and joining is unclear. You will often need to join before you can filter, or you might join after you filter. It all depends on your desired outcome. Combining FME's filtering and joining transformers will let you get your data in precisely the desired shape.</p>
<h2 id="spatial-joining-and-filtering-transformers">Spatial Joining and Filtering Transformers</h2>
<p>Multiple transformers can join data by spatial relationship. Which transformer you use depends on the spatial relationship to be tested and your exact join requirements. The following are some of the key transformers.</p>
<blockquote>
<p><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /></p>
<p><span style="font-family: inherit; font-size: 1em;">Like the key-based joining transformers, there is a flowchart to help you choose a spatial join transformer. See the&nbsp;</span><a style="font-family: inherit; font-size: 1em; background-color: #ffffff;" href="https://support.safe.com/hc/en-us/articles/25407655054221-Merging-or-Joining-Spatial-Data" target="_blank" rel="noopener">Merging or Joining Spatial Data</a><span style="font-family: inherit; font-size: 1em;">&nbsp;article.</span></p>
</blockquote>
<h2 id="overlayers">Overlayers</h2>
<p>There are several different "overlayer" transformers, each handling a different form of overlaying.</p>
<p>For example, the PointOnAreaOverlayer performs a spatial join on points that fall inside area (polygon) features. This operation is sometimes called a "Point in Polygon" overlay. In terms of set theory, overlayers look for the intersection of two streams of spatial features. They return both streams in full but add intersection information as attributes.</p>
<p>As the help explains, "Each point receives the attributes of the area(s) it is contained in, and each containing area receives the attributes of each point it contains."</p>
<p><a href="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic4Transformers/Images/Img4.069.PointOnAreaOverlayerOnCanvas.png" target="_blank" rel="noreferrer noopener"><img class="image image-block image-center" src="images/1740681062258.png" alt="Merge Attributes parameter location in Overlayer transformers" width="795" height="339" /></a></p>
<p>Here, the TransitStation features are provided with a postal code (CFSAUID) that depends on which PostcodeBoundary polygon they fall inside.</p>
<p>The "_overlaps" attribute is another valuable outcome of this transformer. It tells us how many polygons each station fell inside; in this case, overlapping postal codes might be spotted by a station having more than one overlap.</p>
<p>Conversely, the Area output would have an "_overlaps" attribute that would tell us how many stations fell inside each postal code.</p>
<blockquote>
<p><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /></p>
<p><span style="font-family: inherit; font-size: 1em;">Before FME 2020.1, Overlayer transformers automatically merged all attributes. The new default behavior is not to merge attributes, but this parameter can be enabled under Attribute Accumulation &gt; Merge Attributes.</span></p>
</blockquote>
<blockquote>
<p><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /></p>
<p><span style="font-family: inherit; font-size: 1em;">The Overlayer transformers only work with vector data. You can accomplish a similar analysis with raster data using transformers like the&nbsp;</span><a style="font-family: inherit; font-size: 1em; background-color: #ffffff;" href="https://docs.safe.com/fme/html/FME-Form-Documentation/FME-Transformers/Transformers/pointonrastervalueextractor.htm" target="_blank" rel="noopener">PointOnRasterValueExtractor</a><span style="font-family: inherit; font-size: 1em;">.</span></p>
</blockquote>
<h2 id="neighbor-finder">NeighborFinder</h2>
<p>The NeighborFinder transformer carries out a spatial join based on a proximity relationship. Here, the NeighborFinder is being used to identify the closest fire hall to each transit station:</p>
<p><a href="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic4Transformers/Images/Img4.070.NeighborFinderOnCanvas.png" target="_blank" rel="noreferrer noopener"><img class="image image-block image-center" src="images/1740681190122.png" alt="NeighborFinder parameters" width="866" height="423" /></a></p>
<p>Optionally, the fire hall number, name, address, and phone number attributes are merged onto each Facility feature along with many valuable attributes (not all shown), recording the X/Y coordinate, direction, and distance of the closest fire hall.</p>
<p>The parameters of the NeighborFinder include the ability to specify a maximum distance for the relationship or the maximum number of neighbors to find.</p>
<h2 id="feature-reader">FeatureReader</h2>
<p>The FeatureReader is the spatial equivalent of the DatabaseJoiner transformer. It reads from an external dataset and forms a match based on a spatial relationship between the initiating feature and features in that dataset.</p>
<p>One difference is that the output is not the original feature but the queried feature; hence the name FeatureReader:</p>
<p><a href="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic4Transformers/Images/Img4.071.FeatureReaderOnCanvas.png" target="_blank" rel="noreferrer noopener"><img class="image image-block image-center" src="images/1740681365075.png" alt="FeatureReader Spatial Filter and attribute accumulation parameters" width="886" height="642" /></a></p>
<p>For example, the FeatureReader is used to carry out the same overlay of transit stations and postal codes. The PostcodeBoundaries features are read into the workspace and used to query TransitStations (a table in a Geodatabase) spatially. The stations are retrieved with the attributes of the postcode feature they fall inside.</p>
<p>This also acts as a filter, as stations are not outputted unless they fall inside the postcode boundary.</p>
<h2 id="spatial-filter">SpatialFilter</h2>
<p>As its name suggests, the SpatialFilter filters data according to a spatial relationship. However, it also merges attributes from one feature to another, which makes it a type of spatial join.</p>
<p><a href="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic4Transformers/Images/Img4.072.SpatialFilterJoin.png" target="_blank" rel="noreferrer noopener"><img class="image image-block image-center" src="images/1740681440479.png" alt="SpatialFilter example" width="638" height="242" /></a></p>
<p>The critical part is connecting both Passed and Failed output ports unless you also want to filter the data.</p>
<blockquote>
<p><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /></p>
<p><span style="font-family: inherit; font-size: 1em;">Learn more in our &nbsp;<a href="https://fme.safe.com/webinars/data-integration-basics-merging-joining-data/" target="_blank" rel="noopener">Data Integration Basics: Merging &amp; Joining Data</a> webinar</span><span style="font-family: inherit; font-size: 1em;">.</span></p>
</blockquote>