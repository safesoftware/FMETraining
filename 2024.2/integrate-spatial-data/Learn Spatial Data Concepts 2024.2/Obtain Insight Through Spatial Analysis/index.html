<h2 id="learning-objectives">Learning Objectives</h2>
<p>After completing this lesson, you&rsquo;ll be able to:</p>
<ul>
<li>Define spatial analysis.</li>
<li>Understand how incorporating multiple datasets or calculating values can improve spatial analysis.</li>
<li>Explain why data validation is an integral part of spatial analysis.</li>
<li>Understand how visualization lets you derive value from spatial analysis.</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>&ldquo;<em>Hey [Siri/Google], find the nearest coffee shop</em>&rdquo;</p>
<p>Have you ever wondered how the virtual assistant you carry around in your phone can find nearby businesses? Technically speaking, this all starts with voice recognition&hellip; but let&rsquo;s save that for another time. Today, we&rsquo;re focusing on the spatial analysis done behind the scenes.</p>
<p>Spatial analysis tries to describe, explore, and explain patterns and relationships in topology, geography, and geometry. We use spatial analysis techniques to answer questions about relationships between objects by filtering, measuring, and overlaying spatial data. There are many types of spatial analysis, and we&rsquo;ll discuss a few in this article, but first, let&rsquo;s get some coffee.</p>
<h2 id="behind-the-scenes-of-spatial-analysis">Behind the Scenes of Spatial Analysis</h2>
<p>&ldquo;<em>Hey [Siri/Google], use my device's GPS to determine my current position on Earth. Then, draw a small circle around me so I don&rsquo;t have to wait for you to compare my position to every known coffee shop. For all the coffee shops in my small circle, determine the distance to my current position. Lastly, tell me which is closest and how to get there.</em>&rdquo;</p>
<p><img class="image" src="images/buffer-area-example.jpg" alt="A map showing all coffee shops within a certain distance of my location" /></p>
<p><a href="https://www.google.com/maps" target="_blank" rel="noreferrer noopener"><em>Google Maps</em></a></p>
<p>Okay, you would never say that, but that&rsquo;s how your virtual assistant interprets your &ldquo;nearest coffee shop&rdquo; request. Let&rsquo;s break it down:</p>
<ol>
<li><strong>Determine location&mdash;To begin, we need a starting point. Your virtual assistant will use your handy, built-in GPS to find you exactly where you are</strong>&nbsp;in the world.</li>
<li><strong>Create an area of interest</strong> &mdash; We use a Bufferer transformer to create a circular area around our location. We only care about the closest coffee shop, so there&rsquo;s no need to include coffee shops nationwide. We want to get you your coffee ASAP, so less is more in this case.</li>
<li><strong>Calculate distance</strong> &mdash; How far is each of the coffee shops within your buffer area from where you&rsquo;re currently located?</li>
<li><strong>Create a route</strong>&nbsp;&mdash; Let&rsquo;s get you that coffee!</li>
</ol>
<p><img class="image" src="images/1735862262529.png" alt="An FME workspace for finding the nearest coffee shop" width="1308" height="421" /><br /><em>This&nbsp;<a href="https://fme.safe.com/platform/" target="_blank" rel="noopener">FME</a>&nbsp;workspace shows how your location (1) can be used as a data point along with coffee shop data (2) to determine which shop is best suited for you (3).<br /></em></p>
<p>One of the most potent things about spatial analysis is the ability to incorporate multiple datasets into your analysis. In the example above, we are measuring the distance between two points: your current location and the coffee shops.</p>
<p>Additionally, we&rsquo;re creating a temporary polygon dataset, a buffer area, that will allow us to speed up our analysis by reducing the number of coffee shops we want to include.</p>
<p>By combining data and applying three spatial transformations (<a href="https://support.safe.com/hc/en-us/articles/25407462815885-Buffering-Features-for-Spatial-Relationship-Analysis" target="_blank" rel="noopener">Buffer</a>,&nbsp;<a href="https://support.safe.com/hc/en-us/articles/25407436757005-Point-in-Polygon-Calculations-with-the-PointOnAreaOverlayer" target="_blank" rel="noopener">Point on Area Overlay</a>, and&nbsp;<a href="https://support.safe.com/hc/en-us/articles/25407476771853-Determining-Nearest-Neighbors" target="_blank" rel="noopener">Nearest Neighbor</a>), we can determine which coffee shop is closest!</p>
<h2 id="filtering-the-muscle-behind-spatial-analysis">Filtering: The Muscle Behind Spatial Analysis</h2>
<p>So far, we&rsquo;ve only been worried about which coffee shop is geographically closest to us. But what if you also wanted to know which coffee shop serves ethically sourced coffee?</p>
<p>Like your coffee, your analysis is made the way you want it.</p>
<p>One of the most common steps in spatial analysis is&nbsp;<a href="https://docs.safe.com/fme/html/FME-Form-Documentation/FME-Transformers/Transformers/testfilter.htm" target="_blank" rel="noopener">filtering</a> features based on attribute values. An attribute is a piece of information stored with each geographic feature, e.g., the name of a coffee shop might be stored in a text attribute called Name. Filtering can be as simple as filtering for a boolean value (i.e., &ldquo;x = true/false&rdquo;) or more complex methods like <a href="https://regex101.com/" target="_blank" rel="noopener">regular expressions</a>&nbsp;and&nbsp;<a href="https://docs.safe.com/fme/html/FME-Form-Documentation/FME-Transformers/Transformers/tester.htm" target="_blank" rel="noopener">composite test criteria</a>. For example, suppose our coffee shop dataset includes attribute data about whether the vendor uses ethically sourced beans. In that case, we can use this information to filter out unwanted coffee shops (step 4 below) that do not meet our search criteria (i.e., ethically sourced = true). If your source dataset does not have attributes, you may be able to join additional datasets or create new attributes based on a calculation.</p>
<p><img class="image" src="images/1735862353988.png" alt="An FME workspace filtering out coffee shops you are not interested in" width="1543" height="424" /><br /><em>Adding a validation step (4) to your FME workflow allows you to filter out coffee shops you&rsquo;re not interested in and only keep those that meet your requirements.</em></p>
<p>Regardless of what attributes your data does or doesn&rsquo;t have, it&rsquo;s worth noting that a complete dataset will help make your analysis more thorough and ensure you get an accurate output.</p>
<p>If you&rsquo;ve ever had bad coffee, you know no amount of sugar and/or cream can salvage the taste. Chances are the beans went stale, and now you&rsquo;re stuck with a hot cup of disappointment.</p>
<p>The same is true for spatial analysis or any analysis for that matter. If you start with bad beans (input), you&rsquo;ll have a lousy coffee (output). This is why validating your data and using high-quality datasets in your analysis is essential. Using quality source datasets will help ensure your analysis produces accurate results.</p>
<h2 id="route-analysis-direct-me-in-the-right-direction">Route Analysis: Direct Me In the Right Direction</h2>
<p>We know what coffee shops suit our needs but don&rsquo;t know how to get there. It's time to do some route analysis. Route analysis is determining an optimal path from origin to destination. This may include <a href="https://support.safe.com/hc/en-us/articles/25407483421709-Shortest-Route-Calculations-with-the-ShortestPathFinder" target="_blank" rel="noopener">the shortest path</a>, the path that requires the fewest left turns, or the path that takes you past your favorite pastry shop to grab a bite before you get your coffee.</p>
<p>Route analysis is possible because roads are topological networks of nodes (intersections) and edges (roads). These networks allow us to make calculations based on a source node (current location) to a destination node (coffee shop) on the network. Topological networks define the spatial relationship between connecting or adjacent features in a geographic dataset.</p>
<p>Why is this important? In most cases, you can&rsquo;t walk or drive in a straight line to get from point A to B. Instead, you must traverse your way through a street network to reach your destination. That may include walking or driving along streets and making a left or right turn at an intersection to reach your destination.</p>
<p><img class="image" src="images/1735862890373.png" alt="An FME workspace finding the shortest driving route to the nearest coffee shop" width="1056" height="445" /><br /><em>Now that you&rsquo;ve filtered out your coffee shops of interest, you can integrate this data with a street network dataset. With the correct FME transformers, you can find both directions and identify the shortest route to get your coffee ASAP!</em></p>
<p>Once again, it is worth stressing the importance of&nbsp;<a href="https://support.safe.com/hc/en-us/articles/25407541088269-Tutorial-Data-Validation-and-QA-with-FME" target="_blank" rel="noopener">validating your data</a>&nbsp;before performing an analysis. Validating before analyzing will ensure you don&rsquo;t waste any time (or gas) getting to the coffee shop by taking a less optimal route.</p>
<p>If we were performing a route analysis on a road dataset with <a href="https://support.safe.com/hc/en-us/articles/25407797139981-Data-QA-Identifying-Bad-Topology-in-Linear-Networks" target="_blank" rel="noopener">bad topology like overshoots and undershoots</a>, we likely wouldn&rsquo;t be able to determine the most efficient route to our destination. As a result, you might take more turns than necessary, wasting precious time trying to orient yourself instead of sipping on your beloved coffee. Additionally, for something like route analysis, you&rsquo;ll want to consider the relevancy of the road dataset.</p>
<p>Since new developments are constantly popping up and new roads are paved, you&rsquo;ll want to ensure your analysis uses the most recent roads dataset. You may also want to re-run or <a href="https://community.safe.com/s/article/getting-started-with-automations" target="_blank" rel="noreferrer noopener">schedule your analysis</a> to run when new datasets become available to ensure you are still on the best path. It&rsquo;s worthwhile to re-run a route analysis in case a new road is added to the network, as it could make the path from your house to the coffee shop more efficient, saving you time and money in the long run.</p>
<p><img class="image" src="images/RouteAnalysis.gif" alt="Shortest path results on a web map" width="1280" height="720" /><br /><em>Some quick spatial analysis processes make finding the shortest route from A to B simple.</em></p>
<h2 id="cluster-analysis-finding-the-hot-spots">Cluster Analysis: Finding the Hot Spots</h2>
<p>Now we know which coffee shop we want to go to and the fastest route to get there. But your virtual assistant mentioned that it looks a little busy at your destination! This critical information is an example of <a href="https://support.safe.com/hc/en-us/articles/25407793667597-Q-A-ClusterModeller-Kernel-Density-Analysis-with-Points" target="_blank" rel="noopener">cluster analysis</a>.</p>
<p>In today&rsquo;s digital world, we can determine how busy a coffee shop is based on mobile phone location data. How is this possible? Users with location services enabled can access their current position through services like Google Maps. These point datasets can be used to analyze traffic at businesses and can be compared to past statistics. This can be as simple as performing a point-on-area overlay to count how many cell phones were in the coffee shop at a given time. Since there are historical records of cell phone usage, these services can help you determine when the coffee shop is busiest and if they are currently at their usual capacity, more or less busy than normal.</p>
<p><img class="image" src="images/business-cluster-analysis.jpg" alt="Google Maps location showing popular times" /><br /><em>When you click on a business in Google, you can see it&rsquo;s most and least busy. This is all based on cluster analysis going on behind the scenes.</em></p>
<p>This is a fascinating analysis because it requires near real-time data to keep people like you informed about the business you are about to go to. This way, you can make sure that next time you start your coffee shop journey just a bit earlier next time so you&rsquo;re not stuck waiting in line.</p>
<p>One of the earliest examples of cluster analysis was performed by Dr. John Snow in 1894 while London was experiencing a cholera outbreak. Dr. Snow performed a cluster analysis by plotting the&nbsp;<a href="https://ralucanicola.github.io/cholera-map-3D/" target="_blank" rel="noopener">location of deaths on a map of London</a>. This eventually led to the discovery of a contaminated water pump, which later proved his theory of how cholera is spread. What you can learn from simply plotting points on a map is incredible!</p>
<p><img class="image" src="images/john-snow-example.jpg" alt="John Snow's cholera map" /></p>
<h2 id="but-wait-theres-more">But Wait, There&rsquo;s More!</h2>
<p>So far, we&rsquo;ve explored an example of vector-based spatial analysis. This is because the datasets used were points (locations), lines (street networks), and polygons (areas of interest).</p>
<p>However, performing spatial analysis with raster data (imagery or pixel-based data) is equally essential. Raster analysis is commonly used to model the movement of phenomena like <a href="https://firms.modaps.eosdis.nasa.gov/map/#d:2020-11-08..2020-11-09;@0.0,0.0,3.3z" target="_blank" rel="noopener">wildfires</a>&nbsp;and&nbsp;<a href="https://www.sciencedirect.com/science/article/pii/S2468013319301494" target="_blank" rel="noopener">oil spills</a>.</p>
<p>Of course, you&rsquo;re not limited to only rasters or vectors in your analysis either!&nbsp;Spatial analysis transformations&nbsp;allow you to overlay vector features (i.e., points, lines, and polygons) onto raster datasets and vice versa if you want to overlay your&nbsp;<a href="https://support.safe.com/hc/en-us/articles/25407596987661-Draping-Imagery-Textures-on-Terrain-Surfaces" target="_blank" rel="noopener">raster data on top of 3D vector data</a>. You have endless possibilities depending on the output you hope to get from your analysis.</p>
<blockquote>
<p><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /></p>
<p>This lesson is adapted from a&nbsp;<a style="background-color: #ffffff;" href="https://fme.safe.com/blog/2020/11/spatial-analysis-101-coffee-shop-example/" target="_blank" rel="noopener">post</a>&nbsp;on the&nbsp;<a style="background-color: #ffffff;" href="https://www.safe.com/blog" target="_blank" rel="noreferrer noopener">Safe Software blog</a>.</p>
</blockquote>