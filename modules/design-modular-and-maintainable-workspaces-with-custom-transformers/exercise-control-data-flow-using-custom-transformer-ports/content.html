<h2 id="learning-objectives">
  <span>Learning Objectives</span>
</h2>
<p>After completing this lesson, you’ll be able to:</p>
<ul>
  <li>Use multiple instances of a custom transformer.</li>
  <li>Make a custom transformer generic for use anywhere.</li>
  <li>Rename input and output ports in a custom transformer.</li>
</ul>
<h2 id="resources">
  <span>Resources</span>
</h2>
<ul>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedDataTransformation/exercise-control-data-flow-using-custom-transformer-ports.fmw" rel="noreferrer noopener" target="_blank">Starting workspace</a></li>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedDataTransformation/exercise-control-data-flow-using-custom-transformer-ports-complete.fmw" rel="noreferrer noopener" target="_blank">Complete workspace</a></li>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Data/Boundaries/VancouverNeighborhoods.kml" rel="noreferrer noopener" target="_blank">VancouverNeighborhoods.kml</a></li>
</ul>
<h2 id="custom-transformer-input-output-ports">
  <span>Custom Transformer Input/Output Ports</span>
</h2>
<p>Like a normal FME transformer, a custom transformer has a number of input and output ports:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.012.CustomTransformerInputOutputPorts.png" alt="Custom transformer input and output ports" class="image image-block image-center" /></p>
<p>These input and output ports are defined by input/output objects in the custom transformer definition itself:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.013.CustomTransformerDefInputOutputPorts.png" alt="Ports defined by input and output objects in the custom transformer" class="image image-block image-center" /></p>
<h2 id="renaming-ports">
  <span>Renaming Ports</span>
</h2>
<p>The first thing to know is that these input/output objects can be renamed, in order that the transformer ports get named appropriately. You can either double-click the object, choose Rename from the context menu, or press F2, in order to rename the object.</p>
<p>For example, here the user pressed F2 and renames the input port from StringConcatenator_Input to simply Input:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.014.CustomTransformerRenamingPort.png" alt="Renaming a custom transformer port" class="image image-block image-center" /></p>
<p>Renaming the input and output ports is useful for making the custom transformer intentions more explicit; for instance, helping the user to understand what data type is required as input.</p>
<p>For example, after editing the transformer might look like this:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.015.CustomTransformerRenamedPort.png" alt="A custom transformer with edited ports" class="image image-block image-center" /></p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>Here the user simply renamed the input port to Input. Renaming it to "Strings", "Lines", or "Raster" (for example) would help guide other users of the transformer as to what data is required.<br /><br />However, they did rename the output port to illustrate the type of data that will emerge.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2 id="adding-or-removing-ports">
  <span>Adding or Removing Ports</span>
</h2>
<p>Besides renaming ports, it is also possible to add new ports to a custom transformer.</p>
<p>To do so simply select Transformer Input (or Output) from either the menubar or the canvas context (right-click) menu:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.016.AddCustomTransformerInputPort.png" alt="Adding input ports" class="image image-block image-center" /></p>
<p>For example, here a user has ports to handle two streams of input data and two streams of output (one port for the required output, another that handles rejected features:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.017.CustomTransformerMultiInputOutputPorts.png" alt="Custom transformer with two streams of input and output data" class="image image-block image-center" /></p>
<p>This means that each instance of the custom transformer has two input and two output ports:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.018.CustomTransformerMultiInputOutputPorts.png" alt="Edited custom transformer with two input and output ports" class="image image-block image-center" /></p>
<h2 id="exercise">
  <span>Exercise</span>
</h2>
<p>You are continuing to work with your colleague who created a workspace that calculates the population density for neighborhoods in the city of Vancouver.</p>
<p>You turned their workspace into a custom transformer for reuse in the last exercise. Now you need need to show how to use it multiple times and apply edits to its definition.</p>
<h2 id="1-start-workbench">
  <span>1) Start Workbench</span>
</h2>
<p>Open the <a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedDataTransformation/exercise-control-data-flow-using-custom-transformer-ports.fmw" rel="noreferrer noopener" target="_blank">starting workspace</a> in FME Workbench (2022.0 or later).</p>
<h2 id="2-duplicate-custom-transformer">
  <span>2) Duplicate Custom Transformer</span>
</h2>
<p>Notice that we started with two ExpressionEvaluators and now have one ExpressionEvaluator and one custom transformer. Let's place another instance of the custom transformer in place of the ExpressionEvaluator.</p>
<p>Click on the <strong>ExpressionEvaluator_2011 </strong>and press the delete key to delete it.</p>
<p>Click on the <strong>DensityEvaluator </strong>custom transformer and press Ctrl+D (or right-click &gt; <strong>Duplicate</strong>) to create a duplicate copy of it. This is the same effect as placing a new instance, but quicker. You could do the same task through Quick Add or the Transformer Gallery if you desired.</p>
<p>Connect the second <strong>DensityEvaluator </strong>into the workflow, in parallel and not in series:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.204.Ex2.CTOnCanvasReused.png" alt="Two DensityEvaluators in parallel" class="image image-block image-center" /></p>
<h2 id="3-set-custom-transformer-parameters">
  <span>3) Set Custom Transformer Parameters</span>
</h2>
<p>By creating a second instance of the custom transformer we've started to re-use our content, which is great. However, the second instance is currently processing the wrong data.</p>
<p>Inspect the parameters for <strong>DensityEvaluator_2 </strong>and set the population parameter to <code>TotalPopulation2011</code> (not 2001):</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.205.Ex2.CTReusedEditParameter.png" alt="Choosing an attribute as a parameter for the DensityEvaluator" class="image image-block image-center" /></p>
<h2 id="4-run-workspace">
  <span>4) Run Workspace</span>
</h2>
<p>Run the workspace and inspect the output to ensure the data is being processed correctly.</p>
<p>One obvious problem with the output from the transformer is that the result is put into an attribute called <code>PopulationDensity2001</code>, regardless of what data is being processed.</p>
<p>This is not useful; for example, the 2011 results also get the same name, as would any other scenario where we used this transformer. We should improve this by making the output name more generic.</p>
<h2 id="5-edit-custom-transformer">
  <span>5) Edit Custom Transformer</span>
</h2>
<p>Click on the tab labeled <strong>DensityEvaluator </strong>to switch the canvas to the custom transformer definition. Inspect the <strong>ExpressionEvaluator_2001 </strong>parameters. Change the Transformer name to <strong>ExpressionEvaluator</strong> since we are processing more than just 2001 data. Then change the name of the<strong> New Attribute</strong> parameter to DensityResult:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.206.Ex2.CTEditExpressionEvalParameter.png" alt="Configuring the ExpressionEvaluator" class="image image-block image-center" /></p>
<p>If you run the workspace again (run it from at least the custom transformer onwards) you’ll notice that <code>DensityResult</code> is the attribute output by both instances of the custom transformer; i.e., one edit has fixed both of them!</p>
<h2 id="6-rename-ports">
  <span>6) Rename Ports</span>
</h2>
<p>We should also change the custom transformer's port names. At the moment they are not very elegant.</p>
<p>Back within the <strong>DensityEvaluator </strong>tab, click the <strong>cogwheel icon </strong>of the input port object (currently labeled AreaCalculator_Input). Inspect its parameters and change the <strong>Transformer Input Name </strong>to Input.</p>
<p>Now repeat the process for the output port object, renaming <strong>Transformer Output Name</strong> to Output:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.207.Ex2.CTRenamingPorts.png" alt="Changing transformer port names" class="image image-block image-center" /></p>
<p>Click the <strong>Main</strong> tab to check back on the main canvas and confirm the changes have been made:</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.208.Ex2.CTRenamedPorts.png" alt="Edited custom transformers" class="image image-block image-center" /></p>
<p>You'll need to manually resize the transformers to fit their new naming style, as in the above image.</p>
<h2 id="challenge">
  <span>Challenge</span>
</h2>
<p>You'll need this image to answer the first quiz question.</p>
<p><img src="https://s3.amazonaws.com/gitbook/Desktop-Advanced-2019/DesktopAdvanced5CustomTransformers/Images/Img5.019.CustomTransformerCreationWhatPorts.png" class="image image-block image-center" alt="Image for quiz: GeometryFilter:Line to LengthCalculator, GeometryFilter:Area to AreaCalculator, LengthCalculator:Output and AreaCalculator:Output to o StatisticsCalculator. Three transformers (not GeometryFilter) are highlighted with arrows." /><br /><br /></p>