<h2 id="learning-objectives">
  <span>Learning Objectives</span>
</h2>
<p>After completing this lesson, you’ll be able to:</p>
<ul>
  <li>Use a SchemaScanner to pass a schema feature to a dynamic writer.</li>
  <li>Learn how to use the SchemaScanner to apply a schema dynamically and modify it simultaneously.</li>
</ul>
<h2 id="resources">
  <span>Resources</span>
</h2>
<ul>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedReadingAndWriting/exercise-build-dynamic-workflows-with-the-schemascanner.fmw" rel="noreferrer noopener" target="_blank">Starting workspace</a>
    <ul>
      <li>If your computer has FMEData, the file path is C:\FMEData\Workspaces\AdvancedReadingAndWriting\exercise-build-dynamic-workflows-with-the-schemascanner.fmw</li>
    </ul>
  </li>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedReadingAndWriting/exercise-build-dynamic-workflows-with-the-schemascanner-complete.fmw" rel="noreferrer noopener" target="_blank">Complete workspace</a>
    <ul>
      <li>C:\FMEData\Workspaces\AdvancedReadingAndWriting\exercise-build-dynamic-workflows-with-the-schemascanner-complete.fmw</li>
    </ul>
  </li>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Resources/DynamicWorkflows/Data/Cedar%20Cottage.csv" rel="noreferrer noopener" target="_blank">Cedar Cottage.csv</a>
    <ul>
      <li>C:\FMEData\Resources\DynamicWorkflows\Data\Cedar Cottage.csv</li>
    </ul>
  </li>
</ul>
<h2 id="introduction">
  <span>Introduction</span>
</h2>
<p>As we’ve seen, dynamic workflows can obtain their schema from multiple locations.</p>
<p>One of those locations is in the workspace itself, and the <em><a href="https://docs.safe.com/fme/html/FME_Desktop_Documentation/FME_Transformers/Transformers/schemascanner.htm" rel="noreferrer noopener" target="_blank"></a></em><a href="https://docs.safe.com/fme/html/FME_Desktop_Documentation/FME_Transformers/Transformers/schemascanner.htm" rel="noreferrer noopener" target="_blank"></a><a href="https://docs.safe.com/fme/html/FME_Desktop_Documentation/FME_Transformers/Transformers/schemascanner.htm" rel="noreferrer noopener" target="_blank">SchemaScanner</a> transformer is a key tool in making that happen.</p>
<p>The SchemaScanner - as the name suggests - scans incoming features and produces a schema from them. That schema can then be used in a dynamic writer. The schema is stored in a specific FME feature.</p>
<p>The schema produced by this transformer may be different from the reader schema due to processes in the workspace, such as attribute renaming, removal, or addition.</p>
<p>In this workspace, attributes are being added and removed from the reader schema:</p>
<p><img src="images/1682630174589.png" class="image image-block image-center" alt="Example SchemaScanner workspace" /></p>
<p>The SchemaScanner generates a new schema for the output, assigns it a name, and passes it to a dynamic writer. Notice how the schema feature passes from the SchemaScanner:Schema output port to the same writer input port as incoming data. This is a somewhat unusual pattern in FME, so it's worth noting.</p>
<p>The dynamic writer is set up to recognize incoming schema features and will make use of them:</p>
<p><img src="images/1682630214494.png" class="image image-block image-center" alt="Example dynamic writer feature type using Schema from Schema Feature" /></p>
<p>Notice how the Schema Source is set to “Schema From Schema Features” to inform the writer from where the schema is to be obtained. Also, notice the parameter that defines the name of the schema. This handles the situation where the same writer is fed multiple schema features.</p>
<p>Now the data will be written to the output CSV dataset using the schema as modified by the AttributeManager.</p>
<p>A <strong>Schema Feature </strong>stores information about a schema that can be passed to a writer. The information is stored in a list attribute called <em>attribute{}. </em>It contains attribute names and data types, stored as <em>attribute{}.name </em>and <em>attribute{}.fme_data_type:</em></p>
<p><img src="images/1682630250740.png" class="image image-block image-center" alt="Schema feature list attribute" /></p>
<p>Schema features are generated by the SchemaScanner transformer, the FeatureReader transformer, the Schema (Any Format) reader, and even the AttributePivoter transformer!</p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>The Schema generated by the FeatureReader is a copy of the dataset schema.</p>
            <p>The Schema generated by the SchemaScanner is FME’s “best guess.”</p>
            <p>The reason you would want to use the SchemaScanner within your workflow is if you want to scan the schema in the middle of your workspace, after you’ve already read your data in and manipulated it</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<p>Going back to the SchemaScanner, let’s look at the parameters:</p>
<p><img src="images/1682630316895.png" class="image image-block image-center" alt="SchemaScanner parameters" /></p>
<p>The important things to note here are:</p>
<ul>
  <li>The transformer is set up to output the schema feature before any data features. This is vital. The writer must receive the schema feature before any data features that use it.</li>
  <li>The transformer is set up to exclude any attributes that contain fme_, csv_, or multi_from the schema. These are format attributes that we don’t really need in the output.</li>
  <li>Attributes with empty (or null) values will be ignored, i.e., excluded from the output schema, just as if they’d been removed in the AttributeManager.</li>
  <li>The transformer has been instructed to detect dates in the incoming data. If this had not been set, values such as 20220812 would be interpreted as a number, not a date.</li>
</ul>
<h2 id="exercise">
  <span>Exercise</span>
</h2>
<p>The goal here is to transform some CSV data but use a dynamic schema to take account of changes made to the data within the workspace itself.</p>
<h2 id="1-generate-workspace">
  <span>1. Generate Workspace</span>
</h2>
<p>Open FME Workbench (2022.1 or later) and click <strong>Generate Workspace</strong>. Set both Reader and Writer Format to <strong>CSV</strong>. Set the Reader Dataset to <a href="https://s3.amazonaws.com/FMEData/FMEData/Resources/DynamicWorkflows/Data/Cedar%20Cottage.csv" rel="noreferrer noopener" target="_blank">https://s3.amazonaws.com/FMEData/FMEData/Resources/DynamicWorkflows/Data/Cedar%20Cottage.csv</a> (or C:\FMEData\Resources\DynamicWorkflows\Data\Cedar Cottage.csv). Set the Writer Dataset to C:\FMEData\Output\Training. Finally, set the <em>Workflow Options</em> to <strong>Dynamic Schema</strong>.</p>
<p><img src="images/1683320509843.png" class="image image-block image-center" alt="Generate workspace dialog" /></p>
<p>Run the workspace to load the data and inspect it to see what we have.</p>
<h2 id="2-create-new-attributes">
  <span>2. Create New Attributes</span>
</h2>
<p>Add an AttributeManager transformer and connect it between the reader and writer feature types. We'll use it to create a new attribute called Hours, a combination of the Open and Close attributes. Open the Text Editor for the Hours Value and set it to:</p><pre>@Value(Open) - @Value(Close)</pre>
<p>Delete the Open and Close attributes since we no longer need them.</p>
<p><img src="images/1682630447670.png" class="image image-block image-center" alt="Calculating a new attribute Hours and removing Open and Close" /></p>
<p>Be sure to create “Hours” above “Open” and “Close”; otherwise, the deletion occurs first, and Hours has no content. You can use the Up/Down arrows to move attributes.</p>
<p>You can rerun the translation, but the output will still have the same schema. That’s because it’s still coming from the reader and proves why we need the SchemaScanner.</p>
<h2 id="3-add-a-schema-scanner-transformer">
  <span>3. Add a SchemaScanner Transformer</span>
</h2>
<p>Place a SchemaScanner transformer after the AttributeManager and connect the Output and &lt;Schema&gt; ports to the writer feature type.</p>
<p>Check the transformer parameters. Ensure that Output Schema Before Data Features is set to Yes.</p>
<p>For Ignore Attributes Containing, enter:</p><pre>fme_|csv_|multi_</pre>
<p><img src="images/1682630480281.png" class="image image-block image-center" alt="Ignore Attributes Containing parameter" /></p>
<h2 id="4-modify-writer-parameters">
  <span>4. Modify Writer Parameters</span>
</h2>
<p>Now open the parameters for the &lt;Dynamic&gt; CSV writer feature type </p>
<p>Click the ellipsis [...] button to the right of the Schema Sources parameter. In the dialog, uncheck the box for <strong>Cedar Cottage</strong> and check the box for Schema From Schema Feature:</p>
<p><img src="images/1682630508648.png" class="image image-block image-center" alt="Changing schema source to schema feature" /></p>
<p>Now set the Schema Definition Name parameter to the attribute created by the SchemaScanner, <strong>fme_feature_type_name</strong>.</p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>This example results in an output file called CSV.csv, which isn't ideal. You could give it a static name instead if you prefer. But in other cases where the input feature types have table names, using the fme_feature_type_name ensures those are preserved.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2 id="5-run-workspace">
  <span>5. Run Workspace</span>
</h2>
<p>Your workspace should now look like this:</p>
<p><img src="images/1682630535157.png" class="image image-block image-center" alt="Workspace" /></p>
<p>Run the workspace and inspect the output. It will look like this:</p>
<p><img src="images/1682630563579.png" class="image image-block image-center" alt="Workspace output" /></p>
<p>Note that the Open and Close attributes are not there, but there is an attribute called Hours.</p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>The power of the SchemaScanner lies in what would happen if the underlying data changed. In this workspace, FME will write out whatever schema it receives, but as long as there are attributes called Open and Close, FME will create a new attribute, Hours, and will not write Open or Close.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2 id="6-save-workspace">
  <span>6. Save Workspace</span>
</h2>
<p>Save the workspace. We'll use it as the starting point for the next <a href="https://safe.my.trailhead.com/content/safe/modules/construct-schema-dynamically-with-the-schemascanner/exercise-build-dynamic-workflows-with-a-multi-dataset-schemascanner" rel="noreferrer noopener" target="_blank">exercise</a>.</p>