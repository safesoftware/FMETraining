<h2 id="learning-objectives">
  <span>Learning Objectives</span>
</h2>
<p>After completing this lesson, you'll be able to:</p>
<ul>
  <li>Set up a spreadsheet for use as a dynamic translation schema.</li>
  <li>Use the Schema (from Table) reader to read a schema from a spreadsheet.</li>
  <li>Use the Schema From Schema Feature schema source to use schema from a schema feature.</li>
</ul>
<h2 id="resources">
  <span>Resources</span>
</h2>
<ul>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedReadingAndWriting/exercise-define-schema-from-a-schema-table-or-schema-feature.fmw" rel="noreferrer noopener" target="_blank">Starting workspace</a>
    <ul>
      <li>If your computer has FMEData, the file path is C:\FMEData\Workspaces\AdvancedReadingAndWriting\exercise-define-schema-from-a-schema-table-or-schema-feature.fmw</li>
    </ul>
  </li>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedReadingAndWriting/exercise-define-schema-from-a-schema-table-or-schema-feature-complete.fmw" rel="noreferrer noopener" target="_blank">Completed workspace</a>
    <ul>
      <li>C:\FMEData\Workspaces\AdvancedReadingAndWriting\exercise-define-schema-from-a-schema-table-or-schema-feature-complete.fmw</li>
    </ul>
  </li>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Resources/DesktopAdvanced/CommunityMapSchema.xlsx" rel="noreferrer noopener" target="_blank">CommunityMapSchema.xlsx</a>
    <ul>
      <li>C:\FMEData\Resources\DesktopAdvanced\CommunityMapSchema.xlsx</li>
    </ul>
  </li>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Resources/DesktopAdvanced/CommunityMapAdvancedSchema.xlsx" rel="noreferrer noopener" target="_blank">CommunityMapAdvancedSchema.xlsx</a>
    <ul>
      <li>C:\FMEData\Resources\DesktopAdvanced\CommunityMapSchema.xlsx</li>
    </ul>
  </li>
  <li><a href="https://s3.amazonaws.com/FMEData/FMEData/Data/Zoning.zip" rel="noreferrer noopener" target="_blank">Zoning.zip</a>
    <ul>
      <li>C:\FMEData\Data\Zoning\Zones.tab</li>
    </ul>
  </li>
</ul>
<h2 id="introduction">
  <span>Introduction</span>
</h2>
<p>In the past exercise, you created a new community map dataset for the planning department using a dynamic schema. We defined only two tables at the time, but now another is required, and the planning department wants you to update the workspace.</p>
<p>Rather than making changes each time they add more datasets, you believe you can create an Excel spreadsheet containing the schema definition. That way, the planning team can edit it themselves and do the same for all future updates.</p>
<h2 id="1-inspect-spreadsheet">
  <span>1) Inspect Spreadsheet</span>
</h2>
<p>Open and examine the spreadsheet <a href="https://s3.amazonaws.com/FMEData/FMEData/Resources/DesktopAdvanced/CommunityMapSchema.xlsx" rel="noreferrer noopener" target="_blank">CommunityMapSchema.xlsx</a> (or C:\FMEData\Resources\DesktopAdvanced\CommunityMapSchema.xlsx).</p>
<p>If you don't have Excel, open it in the FME Data Inspector and switch to Table View.</p>
<p><img src="images/1673653632337.png" class="image image-block image-center" alt="Schema defined in an Excel table" /></p>
<p>The table has schema definitions for Firehalls, Parks, and Zones feature types. You can see how each new table has a series of attributes defined for it (each attribute is a separate row in the spreadsheet), including attribute type and attribute order. Geometry type only needs to be defined once per table.</p>
<h2 id="2-start-workbench">
  <span>2) Start Workbench</span>
</h2>
<p>Start FME Workbench (2022.1 or later). Open the workspace from the previous exercise or the <a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedReadingAndWriting/exercise-define-schema-from-a-schema-table-or-schema-feature.fmw" rel="noreferrer noopener" target="_blank">starting workspace</a>.</p>
<p><img src="images/1673653823165.png" class="image image-block image-center" alt="Starting workspace" /></p>
<h2 id="3-delete-community-map-resource-reader">
  <span>3) Delete CommunityMap Resource Reader</span>
</h2>
<p>Because we are using a spreadsheet to define our output schemas, the CommunityMap Resource Reader is no longer needed. Locate it in the Navigator window, right-click it, and choose Delete.</p>
<p><img src="images/1683848156484.png" class="image image-block image-center" alt="Removing the reader resource" /></p>
<p>When prompted, click Yes to confirm that FME will remove all references to this dataset.</p>
<h2 id="4-add-excel-file-as-reader-resource">
  <span>4) Add Excel File as Reader Resource</span>
</h2>
<p>Now select Readers &gt; Add Reader as Resource. In the dialog that opens, choose:</p>
<table class="featureTable sort_table">
  <tbody class="tbody">
    <tr>
      <td><strong>Reader Format</strong></td>
      <td>Schema (From Table)</td>
    </tr>
    <tr>
      <td><strong>Reader Dataset</strong></td>
      <td><a href="https://s3.amazonaws.com/FMEData/FMEData/Resources/DesktopAdvanced/CommunityMapAdvancedSchema.xlsx" rel="noreferrer noopener" target="_blank">https://s3.amazonaws.com/FMEData/FMEData/Resources/DesktopAdvanced/CommunityMapAdvancedSchema.xlsx</a> or C:\FMEData\Resources\DesktopAdvanced\CommunityMapSchema.xlsx</td>
    </tr>
  </tbody>
</table>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>Be sure to use the <strong>Schema (From Table)</strong> format and <em>not</em> the Excel format!</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<p>Click the Parameters button (OK will be greyed-out until you do). This dialog is where we can define how the table maps to the required schema.</p>
<p>Check the reader parameters at the top. They should show the dataset is an Excel format file. Select Sheet1 under the Select Table parameter if it is not already selected:</p>
<p><img src="images/1683848460243.png" class="image image-block image-center" alt="Select Sheet1" /></p>
<p>The first row should get used as the field names. If this is not the case, then click the parameters button above and set the values correctly:</p>
<p>Next, select the appropriate fields to match the required parameters (for example, Feature Type = FeatureType):</p>
<p><img src="images/1673654482467.png" class="image image-block image-center" alt="Matching column names to their function" /></p>
<p>Click OK to close the dialog and again to add the resource reader.</p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>You can give the fields in such a lookup table any name you desire. In this example, we used the same name as the parameter to make the relationship obvious. Some of them (Geometry Type and Attribute Sequence) are optional and don't have to be part of the schema definition if not needed.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2 id="5-set-dynamic-parameters">
  <span>5) Set Dynamic Parameters</span>
</h2>
<p>Now inspect the feature type parameters for the writer feature type.</p>
<p>Under the User Attributes tab, remove the LastUpdatedBy attribute, as we've added this to the spreadsheet definition for each type and no longer need it here.</p>
<p>In the Parameters tab, click the Schema Sources edit button. Uncheck FireHalls and check CommunityMapSchema [SCHEMA_FROM_TABLE]:</p>
<p><img src="images/1673654516191.png" class="image image-block image-center" alt="Setting Schema Source to Schema From Table" /></p>
<p>Accept the changes to these parameters.</p>
<h2 id="6-add-reader">
  <span>6) Add Reader</span>
</h2>
<p>If you noticed, the schema spreadsheet included an entry for the Zones dataset, so add a reader (not a Resource â€“ we want the data this time) as follows:</p>
<table class="featureTable sort_table">
  <tbody class="tbody">
    <tr>
      <td><strong>Reader Format</strong></td>
      <td>MapInfo TAB (MITAB)</td>
    </tr>
    <tr>
      <td><strong>Reader Dataset</strong></td>
      <td><a href="https://s3.amazonaws.com/FMEData/FMEData/Data/Zoning.zip" rel="noreferrer noopener" target="_blank">https://s3.amazonaws.com/FMEData/FMEData/Data/Zoning.zip</a> or C:\FMEData\Data\Zoning\Zones.tab</td>
    </tr>
  </tbody>
</table>
<p>Once added, connect its reader feature type to the dynamic writer feature type.</p>
<p><img src="images/1673654555212.png" class="image image-block image-center" alt="Zoning reader feature type added" /></p>
<h2 id="7-save-and-run-workspace">
  <span>7) Save and Run Workspace</span>
</h2>
<p>Save the workspace and then run it.</p>
<p>Inspect the output. Notice that FME has written all three feature types, and their attribute schema matches what we defined in the Excel spreadsheet, including the LastUpdatedBy field for each one.</p>
<p>However, we still have not instructed FME on how to link the new, externally defined schema and the existing one. For this reason, all of the new attributes defined in the external schema table have missing values in the output data. We'll examine how to address this issue using the SchemaMapper in the next exercise.</p>
<h2 id="8-use-a-feature-reader-and-schema-feature">
  <span>8) Use a FeatureReader and Schema Feature</span>
</h2>
<p>Before we address the schema mapping issue, let's try using a FeatureReader and schema feature to define the output schema in a dynamic workspace.</p>
<p>We'll keep the existing objects in the workspace and use them in the next exercise. But let's add a new Creator and FeatureReader to show a different way to configure a dynamic workspace.</p>
<p>Connect the Creator to the FeatureReader and configure the FeatureReader like this:</p>
<table class="featureTable sort_table">
  <tbody class="tbody">
    <tr>
      <td><strong>Reader Format</strong></td>
      <td>MapInfo TAB (MITAB)</td>
    </tr>
    <tr>
      <td><strong>Reader Dataset</strong></td>
      <td><a href="https://s3.amazonaws.com/FMEData/FMEData/Data/Zoning.zip" rel="noreferrer noopener" target="_blank">https://s3.amazonaws.com/FMEData/FMEData/Data/Zoning.zip</a>,<a href="https://s3.amazonaws.com/FMEData/FMEData/Data/Parks.zip" rel="noreferrer noopener" target="_blank">https://s3.amazonaws.com/FMEData/FMEData/Data/Parks.zip</a> or C:\FMEData\Data\Zoning\Zones.tab,C:\FMEData\Data\Parks\Parks.tab</td>
    </tr>
    <tr>
      <td><strong>Output Ports</strong></td>
      <td>Single Output Port</td>
    </tr>
  </tbody>
</table>
<p>Click OK and run your workspace. This section of your workspace should look like this:</p>
<p><img src="images/1674518334280.png" class="image image-block image-center" alt="Creator and FeatureReader" /></p>
<p>If you inspect the output ports, you will notice two things:</p>
<ol>
  <li>The &lt;Schema&gt; output port contains two schema features. They have unexposed attributes that describe this schema.</li>
  <li>The &lt;Generic&gt; output port exports all the features from the two source datasets. They do not have exposed attributes. If you inspect them, you'll find they contain the source schema attributes as unexposed attributes. They also have the unexposed attribute fme_feature_type, which correctly names their source table, Parks or Zones.</li>
</ol>
<p>We can use these two sets of features to write our data using a generic writer.</p>
<h2 id="9-add-and-configure-another-dynamic-writer">
  <span>9) Add and Configure Another Dynamic Writer</span>
</h2>
<p>Use Writers &gt; Add Writer to add a writer. Configure it like this:</p>
<table class="featureTable sort_table">
  <tbody class="tbody">
    <tr>
      <td><strong>Writer Format</strong></td>
      <td>OGC GML (Geography Markup Language)<br /></td>
    </tr>
    <tr>
      <td><strong>Writer Dataset</strong></td>
      <td>C:\FMEData\Output\Training\NewCommunityMapSchemaFeature.gml<br /></td>
    </tr>
    <tr>
      <td><strong>Feature Type Definition</strong></td>
      <td>Dynamic (Advanced)</td>
    </tr>
  </tbody>
</table>
<p>Click OK to add the writer feature type. Move it next to your FeatureReader and connect it to the &lt;Schema&gt; and &lt;Generic&gt; ports.</p>
<p><img src="images/1674600518487.png" class="image image-block image-center" alt="Writer added" /></p>
<p>Double-click the writer feature type. You will see that it is automatically configured to use the fme_feature_type attribute to define the destination feature type names. That is correct. However, it is currently using the readers as Schema Sources. Click the ellipsis next to Schema Sources and choose only Schema From Schema Feature.</p>
<p><img src="images/1674600691480.png" class="image image-block image-center" alt="Changing Schema Source" /></p>
<p>Click OK twice to close the dialogs.Â </p>
<h2 id="10-save-and-rerun-entire-workspace">
  <span>10) Save and Rerun Entire Workspace</span>
</h2>
<p>Rerun the entire workspace. Inspect the output of the &lt;Dynamic&gt; writer feature type you just configured. You will find both the Parks and Zoning layers written out to GML with their original schemas.</p>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>The schema feature method, as illustrated here, allows you to write out the results of any data read in by a FeatureReader without modifying the underlying schema or having to use a SchemaMapper. It's limited to a single format in this example, though you could combine it with a Generic writer or multiple writers to handle multiple output formats. We'll look more at using schema features in the next course in the Learning Path, <a href="https://safe.my.trailhead.com/content/safe/modules/construct-schema-dynamically-with-the-schemascanner" rel="noreferrer noopener" target="_blank">Construct Schema Dynamically with the SchemaScanner</a>.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>