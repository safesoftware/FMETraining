<h2 id="learning-objectives">Learning Objectives</h2>
<p>After completing this lesson, you&rsquo;ll be able to:</p>
<ul>
<li>Add an Automations writer to a workspace.</li>
<li>Add and configure a Log a Message Action.</li>
<li>Trigger and view the results of a Log A Message Action.</li>
</ul>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AutomateWorkflows/exercise-use-the-automations-writer.fmwt" target="_blank" rel="noreferrer noopener">Starting workspace template</a>
<ul>
<li>C:\FMEData\Workspaces\AutomateWorkflows\exercise-use-the-automations-writer.fmwt</li>
</ul>
</li>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AutomateWorkflows/exercise-use-the-automations-writer-complete.fmwt" target="_blank" rel="noreferrer noopener">Complete workspace template</a>
<ul>
<li>C:\FMEData\Workspaces\AutomateWorkflows\exercise-use-the-automations-writer-complete.fmwt</li>
</ul>
</li>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Data/Engineering/BuildingFootprints.zip" target="_blank" rel="noreferrer noopener">BuildingFootprints.zip</a>
<ul>
<li>C:\FMEData\Data\Engineering\BuildingFootprints</li>
</ul>
</li>
</ul>
<div class="box message info">
<div class="inner">
<div class="bd">
<div class="media">
<blockquote><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /><br /><br /><span style="font-family: inherit; font-size: 1em;">All resources are available via the links above. If you are using a Safe Software training machine or downloaded FMEData, you can use the local paths.</span></blockquote>
</div>
</div>
</div>
</div>
<!-- The script tag should live in the head of your page if at all possible -->
<p>
<script type="text/javascript" src="https://play.vidyard.com/embed/v4.js"></script>
</p>
<!-- Put this wherever you would like your player to appear -->
<h2 id="introduction">Introduction</h2>
<p>You have recently created an Automation in FME Flow that processes building footprint updates with both the Resource or Network Directory (updated) and Email Triggers. The Automation monitors a Shared Resource Data folder on FME Flow for new building footprint shapefiles, then adds the updates to a SpatiaLite database automatically. Now your supervisor is wondering if they can receive a notification whenever the corporate database is updated.</p>
<p>You know it is possible to configure the existing Automation in FME Flow to satisfy this requirement. You also realize that you can use an Automations writer in the workspace to include additional information about the updates made to the corporate database in the notification.</p>
<div class="box message info">
<div class="inner">
<div class="bd">
<div class="media">
<blockquote><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /></blockquote>
<div class="mediaBd">
<div class="message-media-content">
<blockquote>
<p>This is a great use-case for the Email External Action. However, those can be a bit tricky to configure due to email server security.</p>
</blockquote>
<p>Therefore, for simplicity's sake, in this exercise, we will just use the Log a Message Action in place of the Email External Action.</p>
<p>If you are interested in learning how to use an email with Automations, please refer to the&nbsp;<strong>Run Workspaces with Email Triggers</strong>&nbsp;lesson.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<h2 id="1-open-workspace-in-workbench">1) Open Workspace in Workbench</h2>
<p>Open the&nbsp;<a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AutomateWorkflows/exercise-use-the-automations-writer.fmwt" target="_blank" rel="noreferrer noopener">starting workspace template</a> (<code>C:\FMEData\Workspaces\AutomateWorkflows\exercise-use-the-automations-writer.fmwt)</code>in FME Workbench.</p>
<h2 id="2-create-summary-information-for-job">2) Create Summary Information for a Job</h2>
<p>You will update this workspace to generate a summary of the number of records that were updated from the incoming Shapefile. First, you need to create a single feature from the updates. This step is common in FME when you want to log a summary message; you just want to log one per update, not one for every feature in that update.&nbsp;</p>
<p>Add an Aggregator transformer and connect it in parallel to the Shapefile reader feature type like this:</p>
<p><a href="https://s3.amazonaws.com/gitbook/Server-Authoring-2020/ServerAuthoring4RealTime/Images/Img4.439.Ex4.Aggregator.png" target="_blank" rel="noreferrer noopener"><img class="image image-block image-center" src="images/1736973121091.jpg" alt="Starting workspace with Aggregator added" width="570" height="162" /></a></p>
<p><br />Double-click the Aggregator to open its parameters. The only changes from defaults you need to do are 1) set the Accumulation Mode to &ldquo;Use Attributes From One Feature&rdquo; and 2) change the Number of Aggregated Features to be named NumberOfUpdates.</p>
<p><img src="images/1736973259855.jpg" alt="" width="573" height="582" /></p>
<h2 id="3-add-automations-writer">3) Add Automations Writer</h2>
<p>Go to Writers &gt; Add Writer and select the FME Flow Automations format. Set the Feature Type Definition to Automatic... and click OK to add the writer to the canvas.&nbsp;</p>
<p>When prompted, set the Feature Type Name to JobSummary and click OK.</p>
<p>Connect the Automations writer feature type to the output port of the Aggregator transformer.</p>
<p>Each Automation writer feature type will appear as a new output port on your Run a Workspace Action in your Automation.</p>
<p><img src="images/1736973298184.jpg" alt="" /></p>
<h2 id="4-clean-up-automations-writer-attributes">4) Clean up Automations Writer Attributes</h2>
<p>After connecting the Automations writer feature type, you'll notice that all the attributes from the Shapefile data are included on the writer. We don't need all that information within the Automation. Double-click JobSummary to open its parameter dialog, then go to User Attributes and select Manual under Attribute Definition.</p>
<p>Remove all the attributes except for the one we created earlier, NumberOfUpdates. Set the Type for NumberOfUpdates to int, as this is a numeric value.</p>
<p><a href="https://s3.amazonaws.com/gitbook/Server-Authoring-2020/ServerAuthoring4RealTime/Images/Img4.440.Ex4.FeatureTypeDefinition.png" target="_blank" rel="noreferrer noopener"><img class="image image-block image-center" src="images/1736973325245.jpg" alt="Setting User Attributes" width="636" height="287" /></a></p>
<p>Click OK to apply that change. At this stage, there should be two attributes on the JobSummary Feature Type: <strong>NumberOfUpdates</strong>&nbsp;and<strong> fme_feature_type</strong>.</p>
<p><a href="https://s3.amazonaws.com/gitbook/Server-Authoring-2020/ServerAuthoring4RealTime/Images/Img4.441.Ex4.FeatureTypeFinal.png" target="_blank" rel="noreferrer noopener"><img class="image image-block image-center" src="images/1736973350258.jpg" alt="Connecting Aggregator to new JobSummary writer feature type" width="210" height="78" /></a></p>
<h2 id="5-save-and-publish-workspace">5) Save and Publish Workspace</h2>
<p>Save the workspace.</p>
<p>Select File &gt; Publish it to FME Flow.&nbsp;</p>
<p>Choose your FME Flow Connection to use. Click Next.</p>
<p>Use the Training Repository (click New... and create it if it doesn't exist). Check Upload data files. Click Next.</p>
<p>Ensure only the Job Submitter service is checked. Click Publish.</p>
<h2 id="6-import-fme-server-project">6) Build an Automation</h2>
<p>Next, you will create an Automation that will check for building updates using the workspace you just published.&nbsp;</p>
<p>Navigate to the FME Flow web interface and click on Automations &gt; Create Automation.&nbsp;</p>
<p><img class="image image-block image-center" src="images/1736973395601.jpg" alt="Create Automations Button" width="236" height="112" /></p>
<p>A trigger is automatically added to the canvas by default. Click the green lightning icon to open Trigger Details.&nbsp;</p>
<p><img src="images/1736973476857.jpg" alt="" width="834" height="380" /></p>
<p>Set a Resource or Network Directory (updated) trigger and set the following parameters:&nbsp;</p>
<p>Directory to Watch: "$(FME_SHAREDRESOURCE_DATA)/BuildingUpdates/"&nbsp;<br />Events to Watch for: Create<br />Poll Interval: 30 seconds</p>
<p><img src="images/1736973633005.jpg" alt="Resource Directory Details" width="569" height="652" /></p>
<p>Click Validate to ensure your settings will work and then navigate to the Output Attributes tab to inspect the attributes available to be used from this trigger. When the workspace runs, you will want to pass the file from the Resource directory to the workspace to read.&nbsp;</p>
<p>Expand Success and Event Attributes. You should see a file.path attribute that we will be use when configuring the workspace parameters. Make sure it is selected.&nbsp;</p>
<p><img src="images/1736973918995.jpg" alt="" /></p>
<p>Click Apply to save your changes and close the trigger details.&nbsp;</p>
<h2 id="7-update-workspace-action">7) Add Filter Action</h2>
<p>Next, you need to use a filter action to the canvas so the directory watch only triggers the worskapce to run when certain files are added. Our workspace only accepts shapefiles so we don't want the workspace to run with an invalid file type.</p>
<p>Add an Internal Action to the canvas and connect it to the success port of the trigger.</p>
<p><img src="images/1736974086075.jpg" alt="" /></p>
<p>Click on the Action icon to edit the details and configure it to filter on the File Path attribute for .shp files.</p>
<p><img src="images/1736974260284.jpg" alt="" width="412" height="414" /></p>
<p>Click Apply to close the Filter Details.&nbsp;</p>
<h2 id="7-update-workspace-action">8) Add Workspace Action</h2>
<p>Add another Internal Action to the canvas and connect it to the Filter success port.</p>
<p><img src="images/1736974367881.jpg" alt="" width="689" height="326" /></p>
<p>Configure this action to Run a Workspace. Select the exercise-use-the-automations-writer.fmw you published to FME Flow in step 5.</p>
<p>Set the Source Esri Shapefile(s) parameter to the File Path attribute from the Directory Watch Trigger.</p>
<p><img src="images/1736974649450.jpg" alt="" width="537" height="420" /></p>
<p>Set the SpatialLite Database path to <code>$(FME_SHAREDRESOURCE_DATA)/Output/building_footprints.sl3</code> and click Apply.</p>
<p><img src="images/1736974758371.jpg" alt="" /></p>
<p>A new output port named JobSummary should appear in the Automation, created by the Automation Writer in the workspace.</p>
<p><img class="image image-block image-center" src="images/1736974897414.jpg" alt="JobSummary port" width="165" height="168" /></p>
<h2 id="8-add-external-action">9) Add External Action</h2>
<p>The final step in the Automation is to add a Log a Message Action through which a response will be sent.</p>
<p>Add another Action and connect it to the JobSummary output port of the Run Workspace node.</p>
<p><strong><img class="image image-block image-center" src="images/1736974907331.jpg" alt="Adding an Action" width="386" height="203" /></strong></p>
<p>Click the icon on Action to open its parameters. Choose Log a message for the Action. Enter the following for the Formatted Message:</p>
<div>
<pre>The Building Footprints database has been updated! {route.JobSummary.NumberOfUpdates} records were updated.</pre>
</div>
<p>If you prefer, you can enter this manually using the Text Editor. You can access it by clicking the drop-down arrow next to Formatted Message and clicking Text Editor.</p>
<p><img class="image image-block image-center" src="https://lh4.googleusercontent.com/wpUyCbDKJ1n0Gz7qYdNiYrrXpBAZi9MW-U4tZ8PijIAkZtmuZKdaMPFkFzYPdgItxRUvDRoNKaedzxdcZM110UnAGLGFcnwxw1b89B1drHGxXNFuovIpG-R7tGLo0Sjf7Nx8p_HvFB9YUzQFtPKMm7E" alt="Setting the Formatted Message using the Text Editor" width="379" height="276" /></p>
<p>All Output Attributes from the previous actions in the automation are found on the left and can be formatted into the text.&nbsp;</p>
<p><img class="image image-block image-center" src="images/1736975973905.jpg" alt="The Text Editor in Automations" width="733" height="459" /></p>
<p>Click OK on the Text Editor and then click Apply to close the Log Details.&nbsp;</p>
<div class="box message info">
<div class="inner">
<div class="bd">
<div class="media">
<blockquote><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /><br /><br /><span style="font-family: inherit; font-size: 1em;">If you were using an Email Action instead of a Log a Message Action, this message could be the body of the email.</span></blockquote>
</div>
</div>
</div>
</div>
<p>Save and start your Automation.</p>
<p><img src="images/1736976128398.jpg" alt="" width="978" height="489" /></p>
<h2 id="9-test-automation">10) Test Automation</h2>
<p>You can test this Automation by uploading <a href="https://s3.amazonaws.com/FMEData/FMEData/Data/Engineering/BuildingFootprints.zip" target="_blank" rel="noreferrer noopener">this ZIP file</a> (C:\FMEData\Data\Engineering\BuildingFootprints) of the Shapefile datasets to FME Flow's Shared Resources Data folder. The Automation trigger is monitoring this folder every 30 seconds; when new files arrive, it will run the workspace, updating the SpatiaLite database building_footprints.sl3. We should be able to see this process by examining the Automation log.</p>
<p>To upload the ZIP file, first, download it.&nbsp;</p>
<p>Then, extract it to a folder called BuildingUpdates.</p>
<p><span class="c10">Then navigate to Resources using the FME Flow web interface. Then click on Data.</span></p>
<p><img class="image image-block image-center" src="https://lh6.googleusercontent.com/GMCdoslgG8DdHYj7cS2NMAfMqFigYUDiGulXvqNg0VfzmUnYcmG78h_nxpFW7rXHWFT0M2mkX8YpXXiFwdOhXDBjT1Ae_p6OWQRL8YCPAuXSt-LV6jFJWFZ2V50aeFLe1HdK5tM2k6DJNCStaO_nIIk" alt="Find the shared Data folder" width="733" height="376" /></p>
<p>Create (or open if it already exists) the BuildingUpdates folder. Click it to view its contents.</p>
<p>Next, click the Upload button and then click Files.</p>
<p><img class="image image-block image-center" src="https://lh6.googleusercontent.com/9RjxxC9JOjsXduQK2aWgwhCVQP88FBs9IzyQkOaHEhg1w1hZ0GCKY0GPCSQl51zhi-5DB3HuAYvl0lj3_iPUMmlEfGjTLltDPpdMtiTjF3ob183GBAP2-0oIC_9QYs_f78UGFcvYBiwEr1jViJKbJ4E" alt="Uploading files" width="230" height="119" /></p>
<p>Select the four files corresponding to one of the updates (e.g., update002.dbf, update002.prj, update002.shp, and update002.shx) and click Upload, and then OK. The SHP update will be uploaded.</p>
<p>Click Automations &gt; Manage Automations &gt; Incoming Building Footprints. Click Menu &gt; View Triggered Jobs. You should see a job for the new building update. If you upload another four files or upload multiple updates at once, you should see one job for each update.</p>
<p><img class="image image-block image-center" src="images/1630088562974.png" alt="Viewing jobs" /></p>
<div class="box message info">
<div class="inner">
<div class="bd">
<div class="media">
<blockquote><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /><br /><br /><span style="font-family: inherit; font-size: 1em;">The polling interval for the Resource or Network Directory (updated) trigger is set to 30 seconds, so it can take a moment for these Jobs to appear.</span></blockquote>
</div>
</div>
</div>
</div>
<p>If you examine the Automation log (Automations &gt; Manage Automations &gt; Incoming Building Footprints &gt; Menu &gt; View Log), you should see one line like this per job:</p>
<div>
<pre>2022-08-27T10:57:04-07:00 | The Building Footprints database has been updated! 44 records were updated.</pre>
</div>
<p>Congratulations! You have successfully used the Automations writer to pass messages out of a workspace.</p>