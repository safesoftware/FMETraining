<h2 id="learning-objectives">Learning Objectives</h2>
<p>After completing this lesson, you&rsquo;ll be able to:</p>
<ul>
<li>Use a SchemaScanner to pass a schema feature to a dynamic writer.</li>
<li>Learn how to use the SchemaScanner to apply a schema dynamically and modify it simultaneously.</li>
</ul>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedReadingAndWriting/exercise-build-dynamic-workflows-with-the-schemascanner.fmw" target="_blank" rel="noreferrer noopener">Starting workspace</a>
<ul>
<li>If your computer has FMEData, the file path is C:\FMEData\Workspaces\AdvancedReadingAndWriting\exercise-build-dynamic-workflows-with-the-schemascanner.fmw</li>
</ul>
</li>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedReadingAndWriting/exercise-build-dynamic-workflows-with-the-schemascanner-complete.fmw" target="_blank" rel="noreferrer noopener">Complete workspace</a>
<ul>
<li>C:\FMEData\Workspaces\AdvancedReadingAndWriting\exercise-build-dynamic-workflows-with-the-schemascanner-complete.fmw</li>
</ul>
</li>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Resources/DynamicWorkflows/Data/Cedar%20Cottage.csv" target="_blank" rel="noreferrer noopener">Cedar Cottage.csv</a>
<ul>
<li>C:\FMEData\Resources\DynamicWorkflows\Data\Cedar Cottage.csv</li>
</ul>
</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>As we&rsquo;ve seen, dynamic workflows can obtain their schema from multiple locations.</p>
<p>One of those locations is in the workspace itself, and the&nbsp;<a href="https://docs.safe.com/fme/html/FME-Form-Documentation/FME-Transformers/Transformers/schemascanner.htm" target="_blank" rel="noopener">SchemaScanner</a>&nbsp;transformer is a key tool in making that happen.</p>
<p>As the name suggests, the SchemaScanner scans incoming features and produces a schema. That schema can then be used in a dynamic writer and stored in a specific FME feature.</p>
<p>The schema produced by this transformer may be different from the reader schema due to processes in the workspace, such as attribute renaming, removal, or addition.</p>
<p>In this example workspace, attributes are being added and removed from the reader schema:</p>
<p><img class="image image-block image-center" src="images/1724098560374.png" alt="Example SchemaScanner workspace" width="853" height="322" /></p>
<p>The SchemaScanner generates a new schema for the output, assigns it a name, and passes it to a dynamic writer. Notice how the schema feature passes from the SchemaScanner's Schema output port to the same writer input port as incoming data. This is a somewhat unusual pattern in FME, so it's worth noting.</p>
<p>The dynamic writer is set up to recognize incoming schema features and will make use of them:</p>
<p><img class="image image-block image-center" src="images/1724098685280.png" alt="Example dynamic writer feature type using Schema from Schema Feature" width="569" height="418" /></p>
<p>Notice how the Schema Source is set to &ldquo;Schema From Schema Features&rdquo; to inform the writer from where the schema is to be obtained. Also, notice the parameter that defines the name of the schema. This handles the situation where the same writer is fed multiple schema features.</p>
<p>Now, FME will write the data to the output CSV dataset using the schema modified by the AttributeManager.</p>
<p>A&nbsp;<strong>Schema Feature&nbsp;</strong>stores information about a schema that can be passed to a writer. The information is stored in a list attribute called&nbsp;<em>attribute{}.&nbsp;</em>It contains attribute names and data types, stored as&nbsp;<em>attribute{}.name&nbsp;</em>and&nbsp;<em>attribute{}.fme_data_type:</em></p>
<p><img class="image image-block image-center" src="images/1724098774860.png" alt="Schema feature list attribute" width="511" height="298" /></p>
<p>Schema features are generated by the SchemaScanner transformer, the FeatureReader transformer, the Schema (Any Format) reader, and even the AttributePivoter transformer!</p>
<blockquote>
<p><img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" /></p>
<p><span style="font-family: inherit; font-size: 1em;">The Schema generated by the FeatureReader is a copy of the dataset schema.</span></p>
</blockquote>
<div class="box message info">
<div class="inner">
<div class="bd">
<div class="media">
<div class="mediaBd">
<div class="message-media-content">
<p>The Schema generated by the SchemaScanner is FME&rsquo;s &ldquo;best guess.&rdquo;</p>
<p>If you want to scan the schema in the middle of your workspace after you&rsquo;ve read your data and manipulated it, you should use the SchemaScanner.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Going back to the SchemaScanner, let&rsquo;s look at the parameters:</p>
<p><img class="image image-block image-center" src="images/1724098919629.png" alt="SchemaScanner parameters" width="481" height="637" /></p>
<p>The important things to note here are:</p>
<ul>
<li>The transformer will output the schema feature before any data features. This is vital. The writer must receive the schema feature before any data features that use it.</li>
<li>The transformer will exclude any attributes that contain fme_, csv_, or multi_from the schema. These are FME and format attributes that we don&rsquo;t need in the output.</li>
<li>The transformer will ignore attributes with empty (or null) values, i.e., excluded from the output schema, just as if they&rsquo;d been removed in the AttributeManager.</li>
<li>The transformer detects dates in the incoming data. If this had not been set, it would interpret values such as 20220812 as numbers, not dates.</li>
</ul>
<h2 id="exercise">Exercise</h2>
<p>The goal here is to transform some CSV data but use a dynamic schema to take account of changes made to the data within the workspace itself.</p>
<h2 id="1-generate-workspace">1. Generate Workspace</h2>
<p>Open FME Workbench (2024.1 or later) and click <strong>Generate Workspace</strong>. Set both Reader and Writer Format to&nbsp;<strong>CSV</strong>.</p>
<p>Set the Reader Dataset to&nbsp;<a href="https://s3.amazonaws.com/FMEData/FMEData/Resources/DynamicWorkflows/Data/Cedar%20Cottage.csv" target="_blank" rel="noreferrer noopener">https://s3.amazonaws.com/FMEData/FMEData/Resources/DynamicWorkflows/Data/Cedar%20Cottage.csv</a>&nbsp;(or C:\FMEData\Resources\DynamicWorkflows\Data\Cedar Cottage.csv).</p>
<p>Set the Writer Dataset to C:\FMEData\Output\Training.</p>
<p>Finally, set the&nbsp;<em>Workflow Options</em>&nbsp;to&nbsp;<strong>Dynamic Schema</strong>.</p>
<p><img class="image image-block image-center" src="images/1724093032126.png" alt="Generate workspace dialog" width="516" height="422" /></p>
<p>Run the workspace to load the data and inspect it to see what we have.</p>
<h2 id="2-create-new-attributes">2. Create New Attributes</h2>
<p>Add an AttributeManager transformer and connect it between the reader and writer feature types. We'll use it to create a new attribute called Hours, a combination of the Open and Close attributes. Open the Text Editor for the Hours Value and set it to:</p>
<pre><code>@Value(Open) - @Value(Close)</code><br /><br /></pre>
<p>Delete the Open and Close attributes since we no longer need them.</p>
<p><img class="image image-block image-center" src="images/1724093200877.png" alt="Calculating a new attribute Hours and removing Open and Close" width="757" height="291" /></p>
<p>Be sure to create &ldquo;Hours&rdquo; above &ldquo;Open&rdquo; and &ldquo;Close&rdquo;; otherwise, the deletion occurs first, and Hours has no content. You can use the Up/Down arrows to move attributes.</p>
<p>You can rerun the translation, but the output will still have the same schema. That&rsquo;s because it&rsquo;s still coming from the reader and proves why we need the SchemaScanner.</p>
<h2 id="3-add-a-schema-scanner-transformer">3. Add a SchemaScanner Transformer</h2>
<p>Place a SchemaScanner transformer after the AttributeManager and connect the Output and &lt;Schema&gt; ports to the writer feature type.</p>
<p>Check the transformer parameters. Ensure that Output Schema Before Data Features is set to Yes.</p>
<p>For Ignore Attributes Containing, enter:</p>
<pre><code>fme_|csv_|multi_</code><br /><br /></pre>
<p>This parameter takes a regular expression. The pipes <code>|</code> represent an OR logic operator, meaning the transformer will ignore attributes containing any of those three strings.</p>
<p>You dialog should look like this:</p>
<p><img class="image image-block image-center" src="https://s3-us-west-2.amazonaws.com/safemytrailhead/modules/construct-schema-dynamically-with-the-schemascanner/exercise-build-dynamic-workflows-with-the-schemascanner/images/1682630480281.png" alt="Ignore Attributes Containing parameter" /></p>
<p>Click OK.</p>
<h2 id="4-modify-writer-parameters">4. Modify Writer Parameters</h2>
<p>Now open the parameters for the &lt;Dynamic&gt; CSV writer feature type&nbsp;</p>
<p>Click the ellipsis [...] button to the right of the Schema Sources parameter. In the dialog, uncheck the box for&nbsp;<strong>Cedar Cottage</strong>&nbsp;and check the box for Schema From Schema Feature:</p>
<p><img class="image image-block image-center" src="images/1724095106724.png" alt="Changing schema source to schema feature" width="536" height="384" /></p>
<p>Click OK.</p>
<p>Now set the Schema Definition Name parameter to the attribute created by the SchemaScanner,&nbsp;<strong>fme_feature_type_name:</strong></p>
<p><img src="images/1724095197182.png" alt="Setting Schema Defintion Name" /></p>
<blockquote>
<p><img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" /></p>
<p><span style="font-family: inherit; font-size: 1em;">This example results in an output file called CSV.csv, which could have a better name. You could give it a static name instead. However, in other cases where the input feature types have table names, using the fme_feature_type_name ensures those are preserved.</span></p>
</blockquote>
<h2 id="5-run-workspace">5. Run Workspace</h2>
<p>Your workspace should now look like this:</p>
<p><img class="image image-block image-center" src="images/1724095277213.png" alt="Workspace" width="854" height="273" /></p>
<p>Run the workspace and inspect the output. It will look like this:</p>
<p><img class="image image-block image-center" src="images/1724095366259.png" alt="Workspace output" width="982" height="143" /></p>
<p>Note that the Open and Close attributes are not there, but there is an attribute called Hours.</p>
<blockquote>
<p><img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" /></p>
<p><span style="font-family: inherit; font-size: 1em;">The power of the SchemaScanner lies in what would happen if the underlying data changed. In this workspace, FME will write out whatever schema it receives, but as long as there are attributes called Open and Close, FME will create a new attribute, Hours, and will not write Open or Close.</span></p>
</blockquote>
<h2 id="6-save-workspace">6. Save Workspace</h2>
<p>Save the workspace. We'll use it as the starting point for the next&nbsp;exercise.</p>