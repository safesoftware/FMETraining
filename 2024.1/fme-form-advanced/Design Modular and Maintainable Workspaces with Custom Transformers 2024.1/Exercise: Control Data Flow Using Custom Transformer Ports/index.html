<h2 id="learning-objectives">Learning Objectives</h2>
<p>After completing this lesson, you&rsquo;ll be able to:</p>
<ul>
<li>Use multiple instances of a custom transformer.</li>
<li>Make a custom transformer generic for use anywhere.</li>
<li>Rename input and output ports in a custom transformer.</li>
</ul>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedDataTransformation/exercise-control-data-flow-using-custom-transformer-ports.fmw" target="_blank" rel="noreferrer noopener">Starting workspace</a>
<ul>
<li>C:\FMEData\Workspaces\AdvancedDataTransformation\exercise-control-data-flow-using-custom-transformer-ports.fmw</li>
</ul>
</li>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedDataTransformation/exercise-control-data-flow-using-custom-transformer-ports-complete.fmw" target="_blank" rel="noreferrer noopener">Complete workspace</a>
<ul>
<li>C:\FMEData\Workspaces\AdvancedDataTransformation\exercise-control-data-flow-using-custom-transformer-ports-complete.fmw</li>
</ul>
</li>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Data/Boundaries/VancouverNeighborhoods.kml" target="_blank" rel="noreferrer noopener">VancouverNeighborhoods.kml</a>
<ul>
<li>C:\FMEData\Data\Boundaries\VancouverNeighborhoods.kml</li>
</ul>
</li>
</ul>
<h2 id="custom-transformer-input-output-ports">Custom Transformer Input/Output Ports</h2>
<p>Like a normal FME transformer, a custom transformer has several input and output ports:</p>
<p><img class="image image-block image-center" src="images/1724696677777.png" alt="Custom transformer input and output ports" width="334" height="107" /></p>
<p>These input and output ports are defined by input/output objects in the custom transformer definition itself:</p>
<p><img class="image image-block image-center" src="images/1724696687682.png" alt="Ports defined by input and output objects in the custom transformer" width="757" height="264" /></p>
<h2 id="renaming-ports">Renaming Ports</h2>
<p>You can rename these input/output objects can be renamed. These changes will appear when you view the custom transformer on the canvas. You can double-click the object, choose Rename from the context menu, or press F2 to rename the object.</p>
<p>For example, here, the user pressed F2 and renamed the input port from StringConcatenator_Input to simply Input:</p>
<p><img class="image image-block image-center" src="images/1724696695919.png" alt="Renaming a custom transformer port" /></p>
<p>Renaming the input and output ports helps make the custom transformer intentions more explicit; for instance, it helps the user understand what data type is required as input.</p>
<p>For example, after editing, the transformer might look like this:</p>
<p><img class="image image-block image-center" src="images/1724696808148.png" alt="A custom transformer with edited ports" width="249" height="77" /></p>
<blockquote>
<p><img class="img mtm" role="presentation" src="https://safemytrailhead.s3.us-west-2.amazonaws.com/images/safe_note.png" alt="Note" /></p>
<p><span style="font-family: inherit; font-size: 1em;">Here, the user renamed the input port to Input. Renaming it to "Strings," "Lines," or "Raster" (for example) would help guide other transformer users as to what data is required.</span></p>
<p><span style="font-family: inherit; font-size: 1em;">However, they renamed the output port to illustrate the emerging data type.</span></p>
</blockquote>
<h2 id="adding-or-removing-ports">Adding or Removing Ports</h2>
<p>Besides renaming ports, adding new ports to a custom transformer is possible.</p>
<p>To do so, select Insert Transformer Input (or Output) from either the menubar or the canvas context (right-click) menu:</p>
<p><img class="image image-block image-center" src="images/1724696862198.png" alt="Adding input ports" width="609" height="343" /></p>
<p>For example, here, a user has ports to handle two streams of input data and two streams of output (one port for the required output, another that handles rejected features:</p>
<p><img class="image image-block image-center" src="images/1724696880626.png" alt="Custom transformer with two streams of input and output data" width="775" height="346" /></p>
<p>This means that each instance of the custom transformer has two input and two output ports:</p>
<p><img class="image image-block image-center" src="images/1724696906748.png" alt="Edited custom transformer with two input and output ports" width="286" height="126" /></p>
<h2 id="exercise">Exercise</h2>
<p>You continue to work with your colleague, who created a workspace that calculates the population density for neighborhoods in Vancouver.</p>
<p>In the last exercise, you turned their workspace into a custom transformer for reuse. Now, you must show how to use it multiple times and apply edits to its definition.</p>
<h2 id="1-start-workbench">1) Start Workbench</h2>
<p>Open the&nbsp;<a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AdvancedDataTransformation/exercise-control-data-flow-using-custom-transformer-ports.fmw" target="_blank" rel="noreferrer noopener">starting workspace</a> in FME Workbench (2024.1 or later).</p>
<h2 id="2-duplicate-custom-transformer">2) Duplicate Custom Transformer</h2>
<p>Notice that we started with two ExpressionEvaluators and now have one ExpressionEvaluator and one custom transformer. Let's place another instance of the custom transformer in place of the ExpressionEvaluator.</p>
<p>Click on the&nbsp;<strong>ExpressionEvaluator_2011&nbsp;</strong>and press the delete key to delete it.</p>
<p>Click on the&nbsp;<strong>DensityEvaluator&nbsp;</strong>custom transformer and press Ctrl+D (or right-click &gt;&nbsp;<strong>Duplicate</strong>) to create a duplicate copy of it. This has the same effect as placing a new instance but is quicker. If desired, you could do the same task through Quick Add or the Transformer Gallery.</p>
<p>Connect the second&nbsp;<strong>DensityEvaluator&nbsp;</strong>into the workflow, in parallel and not in series:</p>
<p><img class="image image-block image-center" src="images/1724705253522.png" alt="Two DensityEvaluators in parallel" width="843" height="211" /></p>
<h2 id="3-set-custom-transformer-parameters">3) Set Custom Transformer Parameters</h2>
<p>By creating a second instance of the custom transformer, we've started to re-use our content, which is great. However, the second instance currently needs to process the correct data.</p>
<p>Inspect the parameters for&nbsp;<strong>DensityEvaluator_2&nbsp;</strong>and set the population parameter to&nbsp;<code>TotalPopulation2011</code>&nbsp;(not 2001):</p>
<p><img class="image image-block image-center" src="images/1724705360219.png" alt="Choosing an attribute as a parameter for the DensityEvaluator" width="349" height="189" /></p>
<h2 id="4-run-workspace">4) Run Workspace</h2>
<p>Run the workspace and inspect the output to ensure FME processed the data correctly.</p>
<p>One obvious problem with the transformer's output is that the result is put into an attribute called <code>PopulationDensity2001</code>, regardless of the data being processed.</p>
<p>This is not useful; for example, the 2011 results also get the same name as would any other scenario where we used this transformer. We should improve this by making the output name more generic.</p>
<h2 id="5-edit-custom-transformer">5) Edit Custom Transformer</h2>
<p>Click the DensityEvaluator tab<strong>&nbsp;</strong>to switch the canvas to the custom transformer definition. Inspect the&nbsp;<strong>ExpressionEvaluator_2001&nbsp;</strong>parameters. Change the Transformer name to&nbsp;<strong>ExpressionEvaluator</strong>&nbsp;since we are processing more than just 2001 data. Then change the name of the<strong> Result</strong>&nbsp;parameter to DensityResult:</p>
<p><img class="image image-block image-center" src="images/1724705426527.png" alt="Configuring the ExpressionEvaluator" width="843" height="276" /></p>
<p>If you rerun the workspace (run it from at least the custom transformer onwards) you&rsquo;ll notice that <code>DensityResult</code>&nbsp;is the attribute output by both instances of the custom transformer; i.e., one edit has fixed both of them!</p>
<h2 id="6-rename-ports">6) Rename Ports</h2>
<p>We should also change the custom transformer's port names. At the moment they are not very elegant.</p>
<p>Within the <strong>DensityEvaluator&nbsp;</strong>tab, click the&nbsp;<strong>cogwheel icon&nbsp;</strong>of the input port object (currently labeled AreaCalculator_Input). Inspect its parameters and change the&nbsp;<strong>Transformer Input Name&nbsp;</strong>to Input.</p>
<p>Now repeat the process for the output port object, renaming&nbsp;<strong>Transformer Output Name</strong>&nbsp;to Output:</p>
<p><img class="image image-block image-center" src="images/1724705475061.png" alt="Changing transformer port names" width="936" height="211" /></p>
<p>Click the&nbsp;<strong>Main</strong>&nbsp;tab to check back on the main canvas and confirm the changes have been made:</p>
<p><img class="image image-block image-center" src="images/1724705582854.png" alt="Edited custom transformers" width="776" height="221" /></p>
<p>As in the above image, you must manually resize the transformers to fit their new naming style.</p>
<h2 id="challenge">Challenge</h2>
<p>You'll need this image to answer the first quiz question.</p>
<p><img class="image image-block image-center" src="images/1724705491522.png" alt="Image for quiz: GeometryFilter:Line to LengthCalculator, GeometryFilter:Area to AreaCalculator, LengthCalculator:Output and AreaCalculator:Output to o StatisticsCalculator. Three transformers (not GeometryFilter) are highlighted with arrows." width="552" height="281" /></p>