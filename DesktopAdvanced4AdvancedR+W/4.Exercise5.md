In Exercise 4d, we created a new community map dataset for the planning department using a dynamic schema. At the time only two tables were defined, but now another one is required and the planning department wants you to update the workspace.

Rather than do that, you figure that you can simply create an Excel spreadsheet containing the schema definition, so the planning team can edit it themselves and do the same for all future updates.

**1)** Inspect Spreadsheet

Open and examine the spreadsheet at:

C:\FMEData2015\Resources\CommunityMapSchema.xlsx.

If you don’t have Excel then open it in the FME Data Inspector and switch to Table View.

The table looks like this, with Firehalls, Parks, and Zones feature types defined.

**2)** Start Workbench

Open the workspace C:\FMEData2015\Workspaces\DesktopAdvanced\Exercise4e-Begin.fmw

This is the workspace you created in Exercise 4d.

**3)** Delete CommunityMap Resource Reader

We no longer need the CommunityMap Resource Reader, so locate it in the Navigator window, right-click on it, and choose Delete.
When prompted, click OK to confirm that all references relating to this dataset will also beremoved.

**4)** Add Excel File as Reader Resource

Now select Readers > Add Reader as Resource. In the dialog that opens choose:

Reader Format Schema (From Table)
Reader Dataset C:\FMEData2015\Resources\CommunityMapSchema.xlsx

Click the parameters button (if you don’t you will be prompted to anyway). This dialog is where we can define how the table maps to the required schema.

Check the Reader parameters at the top. They should show the dataset is an Excel format file.
Select Sheet1 as the table to use:

The first row should get used as the field names. If this is not the case, then click the parameters button above and set the values properly:

Next select the appropriate fields to match to the required parameters (for example Feature Type = FeatureType).

Click OK to close the dialog and again to add the Reader.

Now open the feature type properties dialog for the Writer feature type.

Under the User Attributes tab remove the LastUpdatedBy attribute, as we’ve added this to the spreadsheet definition for each type and no longer need it in here.

In the General tab click the Schema Sources edit button. Uncheck FireHalls and check CommunityMapSchema [SCHEMA_FROM_TABLE].

Click OK and OK again to close these dialogs.

**6)** Add Reader

If you noticed, the schema spreadsheet included an entry for the Zones dataset, so add a Reader (not a Resource – we really want the data this time) as follows:

Reader Format MapInfo TAB (MITAB)
Reader Dataset C:\FMEData2015\Data\Zoning\Zones.tab

Once added, connect its Reader feature type to the dynamic Writer feature type.

**7)** Save and Run Workspace

Save the workspace and then run it.

Inspect the output. Notice that all three feature types have been written, and that their attribute schema matches what was defined in the Excel spreadsheet; including the LastUpdatedBy field for each one.

<table style="border-spacing: 0px">
<tr>
<td style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-cogs fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold;font-family:serif">Advanced Exercise</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange">
<span style="font-family:serif; font-style:italic; font-size:larger">

</span>
</td>
</tr>
</table>

If you have the ability to edit the Excel spreadsheet then let’s do a couple more advanced steps (alternatively you can convert the spreadsheet to a CSV dataset and work in there).

The planning team have decided they should rename some attributes, so open the spreadsheet and rename the following for the FireHalls feature type:
- Name to HallName
- Address to HallAddress
- PhoneNumber to HallPhone

Save the spreadsheet.

If you run the workspace now it will run to completion, but there will be no values in the renamed fields. That’s because FME has no way to tell how to map the source data to the new schema.

We could simply add an AttributeRenamer transformer to handle this change, but the better way is to use the SchemaMapper. That way it can be made a little more dynamic.

In sheet 2 of the spreadsheet, enter:

OldAttrName NewAttrName
Name HallName
Address HallAddress
PhoneNumber HallPhone

Then save the spreadsheet.
Add a SchemaMapper transformer to the workspace, with both output ports connected to the output feature type.

Open the parameters dialog. For the format select the edited Excel file:

Click the parameters button. Under Sheets to Read, turn off Sheet1 and make sure Sheet2 is selected. Click OK to close the dialog.

Click the Next button. In the next dialog, select Add > Attribute Map.

When prompted, select OldAttrName as the source field and NewAttrName as the Destination field. Check the box to Remove the original attributes (i.e. this is a renaming, not copying):

Click OK to close this dialog, then click Finish. Now save and run the workspace again.

This time the output will have its attributes properly mapped. So now the planning department can translate their data, decide on the output schema, and map source to destination attributes dynamically; all by editing this one Excel spreadsheet.