<h2 id="learning-objectives">Learning Objectives</h2>
<p>After completing this lesson, you'll be able to:</p>
<ul>
<li>Use parallel processing in Automations.&nbsp;</li>
<li>Understand when to use the Split-Merge Block.</li>
<li>Create an Automation with the Split-Merge Block.&nbsp;</li>
</ul>
<h2 id="resources">Resources</h2>
<ul>
<ul>
<li><a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AutomateWorkflowsWithFMEFlow/automate-workflows-with-fme-flow--starting-project.fsproject">Starting project</a>&nbsp;| C:\FMEData\Workspaces\AutomateWorkflowsWithFMEFlow\automate-workflows-with-fme-flow--starting-project.fsproject</li>
</ul>
</ul>
<p>If you're taking a live Safe Software-hosted training course or using an on-demand lab for this course, we've already imported the content for this lesson into your FME Flow.<br />If you're completing this lesson with your own FME Flow, you must import the starting project with the content into your FME Flow.&nbsp;</p>
<ul>
<ul><!-- BEGIN: Reusable Custom Expandable Section --></ul>
</ul>
<div>
<style>
  .custom-details {
    background-color: #07D7FF; /* safe blue */
    color: #333;
    padding: 14px;
    margin-bottom: 10px;
    border-radius: 4px;
    cursor: pointer;
  }

  .custom-details summary {
    font-size: 18px;
    font-weight: bold;
    outline: none;
    user-select: none;
    padding: 5px 0;
  }

  .custom-details[open] {
    background-color: #d3d3d3; /* grey */
  }

  .custom-details div {
    padding-top: 10px;
    padding-bottom: 10px;
    padding-left: 12px;
    margin-top: 10px;
    font-size: 16px;
    line-height: 1.5;
  }
</style>
</div>
<details class="custom-details">
<summary>Expand for Steps to Import the Starting Project</summary>
<div>1) Download the <a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AutomateWorkflowsWithFMEFlow/automate-workflows-with-fme-flow--starting-project.fsproject" target="_blank" rel="noopener">starting project</a> and the<a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AutomateWorkflowsWithFMEFlow/automate_workflows_with_fme_flow.jceks" target="_blank" rel="noopener"> encryption key</a>.</div>
<div>2) Upload the <a href="https://s3.amazonaws.com/FMEData/FMEData/Workspaces/AutomateWorkflowsWithFMEFlow/automate_workflows_with_fme_flow.jceks" target="_blank" rel="noopener">automate_workflows_with_fme_flow.jceks</a> encryption key to your FME Flow. This must be done by an fmesuperuser who has permission to System Configuration &gt; Security &gt; System Encryption. For more information, see our documentation on <a href="https://docs.safe.com/fme/html/FME-Flow/WebUI/Encryption.htm" target="_blank" rel="noopener">System Encryption</a>.</div>
<div>3) Navigate to your FME Flow and open Projects. Click Import.&nbsp;</div>
<div><img src="images/1748467877735.jpg" alt="" width="979" height="302" /></div>
<div>4) Upload automate-workflows-with-fme-flow--starting-project.fsproject as the Project File and then click Import.&nbsp;</div>
<div><img src="images/1754602691120.jpg" alt="" /></div>
<div>5) The first step is Preview Content, where you may choose not to overwrite existing items. If all your items are New Items, you don't need to worry about overwriting existing items. Click Continue.</div>
<div><img src="images/1754602971975.jpg" alt="" /></div>
<div>6) The next step is to select connections and tokens to import. By default, they are not selected to be imported. <strong>Select the FME Training PostGIS Database Connection to import.</strong> If it isn't imported, the workflows will not run successfully. Click Continue.&nbsp;</div>
<div><img src="images/1754602868434.jpg" alt="" /></div>
<div>7) The Resolve Owners step only allows you to reassign the project contents to a different user if the admin user doesn't exist on your FME Flow. Click Continue and then click Import Project from the Additional Options step. The project will import and display its import status from the same page.</div>
<div><img src="images/1748469576862.jpg" alt="" width="294" height="108" /></div>
<div>If the project import failed, check that you uploaded the encryption key and repeat the process. If it still fails, contact us at train@safe.com.&nbsp;</div>
</details><!-- The script tag should live in the head of your page if at all possible -->
<p>
<script type="text/javascript" src="https://play.vidyard.com/embed/v4.js"></script>
</p>
<!-- Put this wherever you would like your player to appear -->
<h2 id="introduction">Split-Merge Block</h2>
<p>In FME Flow Automations, you may split your workflows to process multiple actions simultaneously and use FME Flow's parallel processing capabilities with numerous engines. Splitting your workflow lowers the processing time by running multiple workspaces at once. It also increases fault tolerance, as workspaces that run in parallel will still process even if one workspace fails.&nbsp;</p>
<p>When you split your workflows, each stream creates an output. To combine the outputs into a single message in Automations, you use a <a href="https://docs.safe.com/fme/html/FME-Flow/WebUI/Automations-Actions/Merging-Messages.htm">Split-Merge Block</a>. The Split-Merge Block lets you split the Automation workflow into multiple streams and then wait for all components within the block to complete before continuing the workflow along a single stream.&nbsp;</p>
<p><img src="images/1754338223242.jpg" alt="" /></p>
<p>&nbsp;In this workflow, the trigger passes one message to the Split-Merge Block. The workflow is split and sends two messages, one to each workspace. Once the workspaces are complete, each workspace sends a message to the block's success port. The Split-Merge Block combines the two messages into one message and passes it along to the Validation workspace action. Two messages would pass to the Validation workspace without the Split-Merge Block, triggering it to run twice.&nbsp;</p>
<blockquote>
<p><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /><br /><br /><span style="font-family: inherit; font-size: 1em;">The Merge Messages action in FME Flow Automations functions similarily to the Split-Merge Block by merging messages and waiting to process all downstream actions until it receives messages from all previous actions. Compared to the Split-Merge Block, the Merge Messages action limits you from merging messages from multiple triggers and from Automation Writer outputs. Due to these, the Merge Messages action is legacy functionality in Automations and is only present to support backwards compatibility for your workflows. For more information, see our <a href="https://docs.safe.com/fme/html/FME-Flow/WebUI/Automations-Actions/Action-Merge.htm?" target="_self">Merge Messages documentation</a>.&nbsp;</span></p>
</blockquote>
<h2>Automations Writer and Split-Merge Block</h2>
<p>You may also use the Split-Merge Block to combine outputs from Automations Writers in workspace actions. Oftentimes, a single workspace run with an Automations Writer outputs multiple messages through the Automations Writer port, which triggers downstream actions to run multiple times for one initial input message from a trigger. You often only need to send one outgoing message with an external action or process a downstream summary workspace once. In this case, the Split-Merge Block will combine output messages from Automations Writers within it and merge them into one message to output.&nbsp;</p>
<p><img src="https://lh5.googleusercontent.com/JZqiK8wVS0y8c9rot5Ldd5_bnUIrzYaXeLDdznHkDRi3bJxby_1ovNZTrDU7DYhUBi3hgoz3KZ_KpyGiUVx2M0Ds8FJAQfpSwxa4DyU4LDlV3rwzEsASnwVnJAhEN_mzAeu2fQGHhpgWetTNyGt6C0Q" alt="Single Split-Merge block" width="1086" height="385" /></p>
<p>In this example, the Process State workspace action outputs 60 messages through the County Automations Writer port, which enter the Split-Merge Block and trigger the Process County workspace to run 60 times. Each county contains 15 blocks, so the Block Automations Writer outputs 900 messages and triggers the Process Block workspace to run 900 times. The Split-Merge Block waits for all 900 messages from the Process Block workspace, merges them by county, and outputs only 60 messages to the Downstream Work action that processes one job per county.&nbsp;</p>
<h2>Considerations with the Split-Merge Block</h2>
<p>While the Split-Merge Block is handy for your parallel processing or Automations Writer workflows, there are some limitations you should be aware of when you use it:&nbsp;</p>
<ul>
<li>The Split-Merge Block only supports Run a Workspace and Run a Dynamic Workspace actions.&nbsp;</li>
<li>The Split-Merge Block only outputs from a single port, either the success or failure port, not both. If the workspaces send messages to both ports, the failure port takes precedence, and messages are only output from it.&nbsp;</li>
<li>If no messages pass to either output port, the Split-Merge Block will output a single message from the success port to indicate that all jobs within the block are complete.&nbsp;</li>
<li>You cannot directly connect an action upstream in the Automation to an action within the Split-Merge Block; it must connect through the block's input port. You can, however, directly connect an output port from an action within the block to an outside action downstream of the block.&nbsp;</li>
</ul>
<h2 id="1-download-and-import-fme-server-project">Exercise</h2>
<p><img src="images/1754321260052.png" alt="" width="224" height="238" /></p>
<p>Frank is designing an Automation to perform asynchronous data updates daily. He has multiple workspaces for data updates and post-processing, performs data validation, and makes a final product once the updates are complete.&nbsp;</p>
<p>Follow along with Frank's steps as he creates an Automation that uses FME Flow's parallel processing and the Split-Merge Block.&nbsp;</p>
<h3>1) Create Automation</h3>
<p>Frank navigates to FME Flow and creates a new Automation.&nbsp;</p>
<p><img src="images/1754324705144.jpg" alt="" width="977" height="442" /></p>
<h3>2) Configure a Schedule Trigger</h3>
<p>Frank clicks the trigger icon to open its details. He configures an FME Flow Schedule trigger to run on a daily interval. Frank selects Repeat on Interval for Schedule Type and sets the interval to 1 day. He ensures Does Not Expire is selected and clicks Apply to close the trigger details.</p>
<p><img src="images/1754324858781.jpg" alt="" width="704" height="622" /></p>
<h3>3) Add Data Updates Workspaces</h3>
<p>Frank adds a Run a Workspace internal action to the trigger success port. He selects the SpeedyDataUpdate,fmw workspace in the Data Updates and Validation repository. Since the workspace has no configurable parameters, Frank clicks Apply to close the details pane.&nbsp;</p>
<p><img src="images/1754324970296.jpg" alt="" /></p>
<blockquote>
<p><img class="img mtm" role="presentation" src="images/safe_note.png" alt="Note" /><br /><br /><span style="font-family: inherit; font-size: 1em;">The example workspaces for this exercise are placeholders &ndash; they don't really carry out any data integration. However, the Automation design follows common real-world scenario by performing data updates and validation checks.&nbsp;</span></p>
</blockquote>
<p>Frank has another data update that can run asynchronously to the SpeedyDataUpdate workspace. He adds another Run a Workspace action and connects it to the trigger's success port. This time, he selects the LongerDataUpdate.fmw workspace in the Data Updates and Validation repository.&nbsp;</p>
<p><img src="images/1754325533267.jpg" alt="" /></p>
<p>By splitting the workflow, the SpeedyDataUpdate and LongerDataUpdate workspaces will run simultaneously on different FME Engines, as long as multiple engines are available.&nbsp;</p>
<p>After the LongerDataUpdate workspace is complete, the data must undergo post-translation processing. Frank adds another Run a Workspace action and sets it to run the PostProcessing_LDU.fmw workspace in the same repository. He connects it to the success port of the LongerDataUpdate workspace action.&nbsp;</p>
<p><img src="images/1754329850322.jpg" alt="" /></p>
<div class="box message info">
<div class="inner">
<div class="bd">
<h3 class="media">4) Add Workspaces in Sequence</h3>
<p>After both data update processes, Frank needs to run his Validation and MakeDataProduct workspaces in order. Frank adds the Validation.fmw and connects it to the success ports of the SpeedyDataUpdate and the LongerDataUpdate.&nbsp;</p>
<p><img src="images/1754329866646.jpg" alt="" /></p>
<p>After the Validation workspace, Frank adds the MakeDataProduct.fmw, which is also in the Data Updates and Validation repository.&nbsp;</p>
<p><img src="images/1754329617403.jpg" alt="" /></p>
<p>If Frank starts and triggers his Automation, the trigger will send a message to both the Speedy and Longer Data Update workspaces and trigger them to run simultaneously. Once the Speedy Data Update finishes, it sends a message to run the Validation and Make Data Product workspaces. After the Longer Data Update is complete, the Post Processing workspace runs and sends a message to run the Validation and Make Data Product workspaces. Frank's Automation runs the Validation and Make Data Product workspaces twice by splitting the data stream into two and then combining it at the Validation workspace. <img src="images/1754330214870.jpg" alt="" /></p>
<h3>5) Add Split-Merge Block</h3>
<p>Frank wants to run the Validation and Make Data Product workspaces only once per automation trigger, not twice. Therefore, Frank needs to use the Split-Merge Block to split the workflow and merge the messages from the Data Updates before continuing with the Validation workspace.&nbsp;</p>
<p>Frank disconnects the trigger from the first two workspaces and disconnects the Validation workspace from the Speedy Data Update and Post Processing workspaces.&nbsp;</p>
<p><img src="images/1754330530767.jpg" alt="" /></p>
<p>Frank adds a Split-Merge Block to the canvas and places it around the Data Updates and Post Processing workspace actions.</p>
<p><img src="images/1754330735075.jpg" alt="" /></p>
<p>He connects the workspaces to the block's input and success output ports, the trigger to the input port, and the Validation action to the output success port.&nbsp;</p>
<p><img src="images/1754333380971.jpg" alt="" /></p>
<h3>6) Start and Trigger the Automation</h3>
<p>Frank saves his Automation as Daily Data Update and clicks Start to run it. To run the Automation before tomorrow, Frank clicks on the FME Flow Schedule trigger icon and then clicks Trigger from its details pane.&nbsp;</p>
<p><img src="images/1754333819377.jpg" alt="" /></p>
<p>Frank refreshes the Automation canvas after a couple of moments. He sees the event counts show the Validation and Make Data Product workspaces only ran once, meaning his Split-Merge Block worked to merge the output messages from the parallel processes before continuing with the downstream actions.&nbsp;</p>
<p><img src="images/1754598112362.jpg" alt="" /></p>
<h3>7) Inspect Jobs</h3>
<p>Frank navigates to the Jobs page on FME Flow and inspects the jobs that ran from his Automation. He sees that the Speedy and Longer Data Updates started at the same time and ran simultaneously, yet the Validation workspace did not run until the PostProcessing_LDU workspace completed.&nbsp;</p>
<p><img src="images/1754334247544.jpg" alt="" /></p>
</div>
</div>
</div>
<div class="box message info">
<div class="inner">
<div class="bd">
<div class="media">
<blockquote>
<p><span style="font-family: inherit; font-size: 1em;"><img src="images/safe_note.png" alt="Note" /></span></p>
<p><span style="font-family: inherit; font-size: 1em;">If you are very quick, you may catch both the Speedy Data Update and the Longer Data Update workspaces running simultaneously from the Running tab. That is when both workspaces are being processed on separate FME Engines.&nbsp;</span></p>
</blockquote>
</div>
</div>
</div>
</div>
<p>Frank has used the Split-Merge Block to orchestrate parallel processing with FME Flow and merge the workflow back into one before continuing with downstream workspace actions.&nbsp;</p>