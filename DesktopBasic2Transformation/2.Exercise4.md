<!--Exercise Section-->


<table style="border-spacing: 0px;border-collapse: collapse;font-family:serif">
<tr>
<td width=25% style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-cogs fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold">Exercise 4</span>
</td>
<td style="border: 2px solid darkorange;background-color:darkorange;color:white">
<span style="color:white;font-size:x-large;font-weight: bold">Grounds Maintenance Project - Labelling Features</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Data</td>
<td style="border: 1px solid darkorange">City Parks (MapInfo TAB)</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Overall Goal</td>
<td style="border: 1px solid darkorange">Calculate the size and average size of each park in the city, to use in Grounds Maintenance estimates for grass cutting, hedge trimming, etc.</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Demonstrates</td>
<td style="border: 1px solid darkorange">Content transformation with parallel transformers</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Start Workspace</td>
<td style="border: 1px solid darkorange">C:\FMEData2019\Workspaces\DesktopBasic\Transformation-Ex4-Begin.fmw</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">End Workspace</td>
<td style="border: 1px solid darkorange">C:\FMEData2019\Workspaces\DesktopBasic\Transformation-Ex4-Complete.fmw<br>C:\FMEData2019\Workspaces\DesktopBasic\Transformation-Ex4-Complete-Advanced.fmw</td>
</tr>

</table>


Let's continue your work on the grounds maintenance project.

In this part of the project, we’ll create a label for each park and write it to a new output layer. This step is best done using a parallel stream of data.


<br>**1) Start FME Workbench**
<br>Start FME Workbench (if necessary) and open the workspace from Exercise 3. Alternatively you can open C:\FMEData2019\Workspaces\DesktopBasic\Transformation-Ex4-Begin.fmw

The previous exercise measured park areas with the AreaCalculator. Now we are asked to add this information as labels to the output dataset.

This can be accomplished by using the LabelPointReplacer transformer but first, let's add another writer feature type to contain the labels.


<br>**2) Create New Writer Feature Type**
<br>Because we want to write label features to a separate layer (table) in the output, we need to create another feature type object on the canvas. There is more about this in a later chapter, but for now, right-click the writer feature type and choose the option Duplicate. Doing so creates a new feature type (here, a layer, but for other formats could be a table or other grouping of data) in the output dataset.

![](./Images/Img2.230.Ex4.DuplicateFeatureType.png)


Now clean up this feature type's schema. View the feature type's dialog and rename the new feature type to ParkLabels. In the User Attributes tab delete all of the existing user attributes.

---

<!--Tip Section-->

<table style="border-spacing: 0px">
<tr>
<td style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-info-circle fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold;font-family:serif">TIP</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange">
<span style="font-family:serif; font-style:italic; font-size:larger">
You can quickly remove all of the existing user attributes by switching the Attribute Definition to Automatic and then back to Manual. The Automatic will clear it because there are currently no attributes coming in. <strong>This only works for feature types that have not been connected to the rest of the workspace yet</strong>
</span>
</td>
</tr>
</table>

---


<br>**3) Place a StringConcatenator Transformer**
<br>Click onto a blank area of canvas. Type "StringConcatenator" to add a transformer of this type.

Connect it to the Complete port of the StatisticsCalculator by dragging a second connection from there to the new transformer.

![](./Images/Img2.231.Ex4.StringConcatenatorCanvas.png)

Make a new connection from the StringConcatenator to the ParkLabels feature type.

<br>**4) Check the StringConcatenator Parameters**
<br>View the parameters for the StringConcatenator transformer. There are both basic and advanced dialogs, and the basic one looks like this:

![](./Images/Img2.232.Ex4.StringConcatenatorEmptyParams.png)

Enter *LabelText* as the name for the new attribute to create.

In the String Parts section, set the following four parts:

<table>
<th>String Type</th><th>String Value</th>
<tr><td>Attribute Value</td><td>ParkName</td></tr>
<tr><td>New Line</td><td></td></tr>
<tr><td>Attribute Value</td><td>ParkArea</td></tr>
<tr><td>Constant</td><td> sq meters</td></tr>
</table>

Be sure to include a space character in the constant before "sq meters".

![](./Images/Img2.233.Ex4.StringConcatenatorParams.png)

<!--Tip Section-->

<table style="border-spacing: 0px">
<tr>
<td style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-info-circle fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold;font-family:serif">TIP</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange">
<span style="font-family:serif; font-style:italic; font-size:larger">
You may find it quicker to switch to the Advanced editor dialog and enter the content directly:
<br>@Value(ParkName)
<br>@Value(ParkArea) sq meters
</span>
</td>
</tr>
</table>

---

<br>**5) Run the Workspace**
<br>Let's run the workspace to ensure that the StringConcatenator is doing what we expected. Ensure that Feature Caching is enabled, and then click on the StringContatenator to open the popup menu. Then click on Run to This, that way the StringContatenator will run, but we won't be rewriting the data out:

![](./Images/Img2.234.Ex4.RunToStringConcat.png)

Then click the magnifying glass on the output port to view the cache in Visual Preview. If you double-click on any of the features in the LabelText column, a dialog will appear that will show the label strings formatted correctly:

![](./Images/Img2.235.Ex4.StringConcatVP.png)

<br>**6) Place a LabelPointReplacer Transformer**
<br>Click onto the connection between StringConcatenator:Output and the ParkLabels feature type. Type "LabelPointReplacer" to add a transformer of this type.

The new transformer will be added and automatically connected between those two objects.

![](./Images/Img2.236.Ex4.LabelPointReplacerCanvas.png)


<br>**7) Check LabelPointReplacer Parameters**
<br>Inspect the LabelPointReplacer parameters.

Firstly click the drop-down arrow to the right of the Label parameter:

![](./Images/Img2.237.Ex4.LabelEditDialog.png)

Select Attribute Value &gt; LabelText to select the label previously defined in the StringConcatenator.

Now click in the Label Height field and type 25 (that’s 25 working units, which in this case is meters).

The “Always Rotate Label” parameter can be left to its default value.

![](./Images/Img2.238.Ex4.LabelPointReplacerParameters.png)

---

<!--Tip Section-->

<table style="border-spacing: 0px">
<tr>
<td style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-info-circle fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold;font-family:serif">TIP</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange">
<span style="font-family:serif; font-style:italic; font-size:larger">
Many parameter fields (like Label Height) can be set either as a constant value (by typing it in) or set to an attribute by clicking the drop down arrow and selecting Attribute Value.
<br><br>And - as you'll see shortly - it's also possible to construct a parameter value directly inside the transformer settings
</span>
</td>
</tr>
</table>

---

<br>**8) Run the Translation**
<br>Add another bookmark if you wish, then run the translation, since the translation is cached up to the StringContatenator it will only take a moment to write out the data.

Click on the ParksMaintenanceData to open the popup menu, then click on View Written Data:

![](./Images/Img2.239.Ex4.ViewWrittenData.png)

The data will open in Visual Preview, but we want to view both our outputs together, so we will have to move to FME Data Inspector. In Visual Preview, click on the Open in Data Inspector button or hit <kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>D</kbd>. FME Data Inspector will open and display the data in the current view:

![](./Images/Img2.240.Ex4.OpenInDI.png)

Now with FME Data Inspector open, click on the Add data button on the menu bar. This will add data to the current view so we can view the labels on top of the parks:

![](./Images/Img2.241.Ex4.AddDataToView.png)

In the Select Dataset to Add dialog, set the Format to MapInfo TAB (MITAB) and then browse to the ParkLabels Dataset:

<pre>
C:\FMEData2019\Output\ParkLabels.tab
</pre>

Click OK, and the labels should now be on the parks.
Notice that the output is in two layers in two files. Use the FME Data Inspector to open both output files in the same view.

![](./Images/Img2.242.Ex4.LabelsInDIView.png)

<br><span style="font-style:italic;font-size:x-small">Map tiles by <a href="https://stamen.com">Stamen Design</a>, under <a href="https://creativecommons.org/licenses/by/3.0">CC-BY-3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC-BY-SA</a>.


---

<!--Advanced Exercise Section-->

<table style="border-spacing: 0px">
<tr>
<td style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-cogs fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold;font-family:serif">Advanced Exercise</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange">
<span style="font-family:serif; font-style:italic; font-size:larger">
Now you know how to create a new feature type in the output, how to test data, and how to use parallel streams, why not try this task: Identify which parks are smaller than average and which parks are larger than average, and write them out to different feature types.
</span>
</td>
</tr>
</table>

---

<!--Exercise Congratulations Section-->

<table style="border-spacing: 0px">
<tr>
<td style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-thumbs-o-up fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold;font-family:serif">CONGRATULATIONS</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange">
<span style="font-family:serif; font-style:italic; font-size:larger">
By completing this exercise you have learned how to:
<br>
<ul><li>Create a new writer feature type</li>
<li>Use multiple streams of transformers in a single workspace</li>
<li>Use the StringConcatenator to construct a string for use elsewhere</li>
<li>Use an attribute as the value of a transformer's parameter</li></ul>
</span>
</td>
</tr>
</table>
